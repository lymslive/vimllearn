<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>10.2 插件管理器插件介绍</h1>
    <!-- ## 10.2 插件管理器插件介绍 -->
<h2 id="10-2-1-cha-jian-guan-li-de-bi-yao-xing">10.2.1 插件管理的必要性</h2>
<p>上一节介绍了 vim 用户目录（<code>~/.vim</code>，并推荐设为 <code>$VIMHOME</code> 环境变量）。这在自
己写简单脚本是很方便的，按规范将不同性质与功能的脚本放在不同子目录。但这有个潜
在的问题，源于你不能总是自己造轮子，且不论是否有能力造复杂的轮子。</p>
<p>这世界上多年以来有许多狂热的 vim 爱好者，开发了许多优秀的插件，应该善加选择然
后下载安装使用。但是如果都安装到 <code>~/.vim</code> 目录，那来源于不同插件的脚本就混在一
起了，既可能造成脚本同名文件冲突，也不利于后续维护（升级或卸载）。</p>
<p>后来，vim 提供了一种 <code>vimball</code> 的安装方式。就是将一个插件的所有脚本打包成一个
文件，其实也是符合 VimL 语法的脚本，直接用 vim 的 <code>:source</code> 命令，就会把“包”内
的文件解压出来，放到 <code>~/.vim</code> 目录下，并跟踪记录解压了哪些文件，哪个文件来源于
哪个安装包，然后将来要升级替换或下载删除时便有迹可寻。但这仍不可避免来源于不同
插件的脚本同名冲突，且将个人用户目录搞得混杂不堪，对有洁癖的 vim 用户尤其是程
序员是不能忍受的。</p>
<p>再后来，随着 github 的流行，版本控制与代码仓库的概念深入人心，vim 的插件使用与
管理思想也发生了革命性的变化。其实原理也很简单，关键还是 <code>&amp;rtp</code> ，那不是一个目
录，而是一组目录，除了官方 <code>$VIMRUNTIME</code> 与用户目录 <code>$VIMHOME</code> 外，还可以将任
意一个目录加入 <code>&amp;rtp</code> 列表。因此，可以将每个来源于第三方的插件放在另外的一个独
立目录，在该目录内也按 <code>$VIMRUNTIME</code> 目录规范按脚本功能分成 <code>plugin/</code> 、
<code>ftplugin/</code> 等子目录，再将其添加到 <code>&amp;rtp</code> 中。如此，在 vim 运行时也就能在需要
时从这个目录读取第三方插件内的脚本，就和安装（拷贝）到 <code>$VIMHOME</code> 下的效果一
样。只是现在每个插件都有着自己的独立目录，甚至可直接对应 github 仓库，升级维护
变得极其方便了。</p>
<p>在所谓的现代 vim 时代，“插件”这词一般就特指这种有独立目录并按 vim 规范组织子目
录的标准插件，插件内的各子目录的文件一起协作完成某个具体的扩展功能。而之前那个
用户目录 <code>$VIMHONE</code> ，建议只保留给用户自己保存 <code>vimrc</code> 及其他想写的脚本，不再
被安装任何第三方插件。在这之前，<code>$VIMHOME</code> 目录尤其是 <code>plugin/</code> 子目录下的每个
脚本，也许都被称为一个插件，为了区分，或可称之为“广义的插件”。而从现在开始，单
说插件时，只指“狭义”的标准插件（目录）。</p>
<p>当安装插件变得容易时，安装的第三方插件就会越来越多，这时又诞生了另一个需求。那
就是如何再管理所有这些第三方插件？本章的剩下内容就来介绍一些便利的插件管理工具
及其管理思路。这些插件管理工具本身也是个第三方插件。</p>
<h2 id="10-2-2-pathogen">10.2.2 pathogen</h2>
<p>首先介绍一款插件：
<a href="https://github.com/tpope/vim-pathogen">https://github.com/tpope/vim-pathogen</a>。
看其名字 pathogen，大约是“路径生成器”的意思，其主要工作就是管理 vim 的 <code>&amp;rtp</code>
目录列表。</p>
<p>按 pathogen 的思路，是在 <code>$VIMHOME</code> 约定一个 <code>bundle/</code> 子目录，然后将所有想
用的第三方插件下载安装到该目录。对于托管在 github 上的插件，可以直接用 <code>git clone</code> 命令，例如就安装 pathogen 插件本身：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mkdir</span><span style="color:#bf616a;"> -p ~</span><span>/.vim/bundle
</span><span style="color:#bf616a;">$</span><span> cd </span><span style="color:#bf616a;">~</span><span>/.vim/bundle
</span><span style="color:#bf616a;">$</span><span> git clone https://github.com/tpope/vim-pathogen
</span></code></pre>
<p>这样，插件安装部分就完成了，可以如法炮制安装更多插件。然后要 vim 识别这些插件，
让它们真正生效，还要在 <code>vimrc</code> 中加入如下两句：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">set</span><span> rtp+=$VIMHOME</span><span style="color:#96b5b4;">/bundle/</span><span>vim-pathogen
</span><span style="color:#96b5b4;">execute </span><span style="color:#8fa1b3;">pathogen#infect</span><span>()
</span></code></pre>
<p>其中第一句是将 pathogen 本身的插件目录先加到 <code>&amp;rtp</code> 列表，如此才能调用第二句的
<code>pathogen#infect()</code> 函数。很显然，这是个自动加载函数，它会找到
<code>autoload/pathogen.vim</code> 脚本，加载后就能正式调用该函数了。该函数的功能就是扫描
<code>bundle/</code> 下的每个子目录，将它们都加入 <code>&amp;rtp</code> 列表，就如同第一句显式加入那样；
只不过 pathogen 批量扫描，帮你做完剩余的事了。</p>
<p>事实上， pathogen 插件只有 <code>autoload/pathogen.vim</code> 这一个脚本是关键起作用的，
如果将该文件安装（下载或拷贝）到 <code>$VIMHOME</code> 中，那就没必要第一句显式将
pathogen 加入 <code>&amp;rtp</code> ，因为它已经能在 <code>&amp;rtp</code> 中找到了。如果在 Linux 系统，若为
安全或洁癖原因，不想复制污染用户目录，则可用软链接代替：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cd </span><span style="color:#bf616a;">~</span><span>/.vim/autoload
</span><span style="color:#bf616a;">$</span><span> ln</span><span style="color:#bf616a;"> -s</span><span> ../bundle/vim-pathogen/autoload/pathogen.vim pathogen.vim
</span></code></pre>
<p>所以 pathogen 插件本身不必安装在 <code>bundle/</code> 目录中，<code>bundle/</code> 只是它用来管理其
他后续安装的第三方插件。如果不想混在个人用户目录中，pathogen 可以安装在任意合
适的地方，只要在 <code>vimrc</code> 将其加入 <code>&amp;rtp</code> 或如上例做个软链接。</p>
<h2 id="10-2-3-vundle-yu-vim-plug">10.2.3 vundle 与 vim-plug</h2>
<p>pathogen 在管理 <code>&amp;rtp</code> 方面简单、易用，且高效、少依赖。只有一个缺点，那就是还
得手动下载每一个插件。如果连这步也想偷懒，那还有另一类插件管理工具可用，如下几
个都支持自动下载插件：</p>
<ul>
<li><a href="https://github.com/VundleVim/Vundle.vim">https://github.com/VundleVim/Vundle.vim</a></li>
<li><a href="https://github.com/junegunn/vim-plug">https://github.com/junegunn/vim-plug</a></li>
<li><a href="https://github.com/Shougo/dein.vim">https://github.com/Shougo/dein.vim</a></li>
</ul>
<p>其中，Vundle 出现较早，自动安装的插件默认也放在 <code>~/.vim/bundle</code> 目录，只不过需
要在 <code>vimrc</code> 中用 <code>:Plugin</code> 命令指定要使用的插件。现在基本推荐使用 vim-plug 代
替 Vundle ，用法类似，只不过使用更短的 <code>:Plug</code> 命令，而且支持并行下载，所以首
次安装插件的速度大大增快。dein.vim 管理插件则不提供命令，要求直接使用
<code>dein#add()</code> 函数，并且插件安装目录默认不放在 <code>~/.vim/bundle</code> 了。</p>
<p>这里仅以 vim-plug 为例介绍其用法。它只有单脚本文件，官方建议安装到
<code>~/.vim/autoload/plug.vim</code> 中。但正如 <code>pathogen.vim</code> 一样，你可以放到其他位置
，只是首先在手动维护这个插件管理的插件本身的 <code>&amp;rtp</code> 路径。然后在 <code>vimrc</code> 进行
类似如下的配置：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>call </span><span style="color:#8fa1b3;">plug#begin</span><span>(</span><span style="color:#a3be8c;">&#39;~/.vim/bundle&#39;</span><span>)
</span><span>Plug </span><span style="color:#a3be8c;">&#39;author1/plugin-name1&#39;
</span><span>Plug </span><span style="color:#a3be8c;">&#39;author2/plugin-name2&#39;
</span><span>call </span><span style="color:#8fa1b3;">plug#end</span><span>()
</span></code></pre>
<p>显然，<code>plug#bigin()</code> 与 <code>plug#end()</code> 是来自 <code>autoload/plug.vim</code> 脚本的函数，用
于该插件管理工具进行内部初始化等维护工作，其中 <code>plugin#begin()</code> 函数可指定插件
安装目录。然后在这两个函数调用之间，使用 <code>:Plug</code> 命令配置每个需要使用的插件。
参数格式 <code>author1/plugin-name1</code> 表示来源于
<code>https://github.com/author1/plugin-name1</code> 的插件。<code>:Plug</code> 还支持可选的其他参数
，比如用于配置复杂插件下载后可能需要进行的编译命令，这就不展开了。</p>
<p>在 vim 启动时，vim-plug 会分析 <code>vimrc</code> 配置的插件列表，如果插件尚未安装，则会
自动安装，并打开一个友好的窗口显示下载进度及其他管理命令。如果在 vim 运行时编
辑了 <code>vimrc</code> ，修改了插件列表，并不建议重新 <code>:source $MYVIMRC</code> ，而是可以手动
使用 <code>:PlugInstall</code> 命令安装插件。一般只有在修改了插件列表配置后首次启动 vim
时才会触发自动下载的动作，当然下载速度取决于个人的网络环境，不过由于它的并行下
载，横向对比其他插件管理工具的下载速度要快。在安装完插件之后启动 vim 显然就几
乎不会影响启动过程了。当然需要更新已安装插件时，可用 <code>:PlugUpdate</code> 命令。</p>
<p>vim-plug 这类插件管理工具的最大优点是功能丰富，不仅维护插件的 <code>&amp;rtp</code> 路径，还
集成了插件的下载安装。当插件来源于 github 时，使得插件安装过程对于用户极其方便
。相比于 <code>pathogen</code> ，它不仅是替用户偷懒免去手动下载过程，更简化了用户移植个人
vim 配置。比如想将自己的 vim 配置环境从一台机器挪到另一台机器，那只要备份
<code>vimrc</code> 而已（或 <code>~/.vim</code> 目录），而插件列表内置在 <code>vimrc</code> 中，可不必另外备份
，在新机器上首次启动 vim 时自动安装。</p>
<h2 id="10-2-4-vim8-nei-zhi-de-packadd">10.2.4 Vim8 内置的 packadd</h2>
<p>从 Vim8 版本开始，也提供了自己的一套新的插件管理方案，取代曾经昙花一现的 vimball
安装方式。核心命令是 <code>:packadd</code> ，而方案的名词概念叫 <code>package</code> ，可用 <code>:help</code>
命令查看详细帮助文档。</p>
<p>Vim8 内置的插件管理在思想上更接近 pathogen ,就连 pathogen 的作者也在该项目主页
上推荐新用户使用 Vim8 的内置管理方案了。因为这更符合 Vim 一贯以来的 Unix 思维
，集中做好一件事。从 Vim 的角度，插件管理就只要维护好每个插件的 <code>&amp;rtp</code> 路径就
尽职了。至于插件是怎么来的，怎么下载安装的，是用 <code>git clone</code> 还是 <code>svn co</code> ，
或是手动下载再解压，再或是用户自己在本地写的…… Vim 全不管，它只要求你把插件放
到指定的目录，就如一开始规定得把（广义的插件）脚本放在 <code>plugin/</code> 目录一样。</p>
<p>事实上，之前的 vimball 就是 Vim 曾经试图介入用户安装插件过程的一种尝试。但是
vimball 没有成功推广，仅管那方案有可取之处。所以 Vim8 汲取经验教训，package 方
案不再纠结用户安装插件的事了，用户爱怎么折腾就怎么折腾。</p>
<p>现在，就来具体地介绍 package 方案如何做插件何管理的工作。如果将 pathogen 管理的
插件迁移到 Vim8 的 package ，可用如下命令：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mkdir</span><span style="color:#bf616a;"> -p ~</span><span>/.vim/pack/bundle/start
</span><span style="color:#bf616a;">$</span><span> mv </span><span style="color:#bf616a;">~</span><span>/.vim/bundle/* </span><span style="color:#bf616a;">~</span><span>/.vim/pack/bundle/start/  </span><span style="color:#65737e;"># 移动 bundle 目录
</span><span style="color:#bf616a;">$</span><span> ls</span><span style="color:#bf616a;"> -s  ~</span><span>/.vim/pack/bundle/start </span><span style="color:#bf616a;">~</span><span>/.vim/bundle </span><span style="color:#65737e;"># 为兼容原目录名，建个软链接
</span></code></pre>
<p>这里，<code>~/.vim/pack</code> 叫做一个 <code>&amp;packpath</code> 。那也是 Vim8 新增的一个选项，意义与
<code>&amp;runtimepath</code> 或 <code>&amp;path</code> 类似，是一个以逗号分隔的目录列表。</p>
<p>我们将 <code>packpath</code> 译为包路径，其下的每个子目录叫做一个“包”（package），每个包
下面可以有多个插件（plugin）。如果包内的插件设计为需要在 vim 启动时就加载，就
将这类插件放在包下面的 <code>start/</code> 子目录中，如果不想在 vim 启动时就加载，就将插
件放在包下面的 <code>opt/</code> 子目录中。此后，在 vim 运行时，可以用 <code>:packadd</code> 命令将
放在包下面的 <code>opt/</code> 类插件按需求再加载起来（直接在命令行手动输入 <code>:packadd</code> 命
令，或在 VimL 脚本中调用该命令）。</p>
<p>也就是说，在 vim 启动时，会搜索 <code>~/.vim/pack/*/start/*</code> ，将找到的每个目录都认
为是一个标准插件目录，加入 <code>&amp;rtp</code> 列表并加载执行每个 <code>plugin/*.vim</code> 脚本。当使
用 <code>:packadd plug-name</code> 时，就搜索 <code>~/.vim/pack/*/opt/plug-name/</code> 目录，如果找
到，则将其加入 <code>&amp;rtp</code> 并加载其下 <code>plugin/*.vim</code> 脚本。然后，<code>&amp;packpath</code> 也不一定
只有 <code>~/.vim/pack/</code> 一个目录，用户可另外设置或增加包路径。</p>
<p>Vim8 将插件分为 <code>start/</code> 与 <code>opt/</code> 两类，这是容易理解的。因为 vim 要优化启动速
度，允许用户决定哪些插件得在启动加载，哪些可稍后动态加载。那为何又要在这之上再
加个包的概念呢。那估计是前瞻性考虑了，预计将来 vim 用户普遍会安装很多插件，于
是可以进一步将某些相关插件放在一个包内，以便管理。</p>
<p>对用户来说，如何使用包呢？如果从 github 下载的插件，很容易对应，就将作者名作为
包名，于是该作者的所有插件都归于一个包。不过对个人用户来说，极可能只会用到某个
作者的一个插件，并不会对他的所有插件都感兴趣；况且作者本身也可能只会公布少数一
到两个 vim 插件。这样，每个包下面的插件数量太少，又似乎失去了包的初衷意义，而
且包下面深层次目录只有一个子目录，利用率低，不太“美观”。</p>
<p>于是另有一个思路是根据插件功能来划分包名。想探寻某个功能，找到了几个来自不同作
者开发的插件，各有优劣与适用场景，或者就是要多个插件配合使用，那就可以将其归于
一个包。例如，上面介绍的插件管理插件，出于研究目的，可以都将其下载了，统一放在
名为 <code>plug-manager</code> 的包内：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> mkdir</span><span style="color:#bf616a;"> -p ~</span><span>/.vim/pack/plug-manager
</span><span style="color:#bf616a;">$</span><span> cd </span><span style="color:#bf616a;">~</span><span>/.vim/pack/plug-manager
</span><span style="color:#bf616a;">$</span><span> mkdir opt
</span><span style="color:#bf616a;">$</span><span> cd opt
</span><span style="color:#bf616a;">$</span><span> git clone https://github.com/tpope/vim-pathogen
</span><span style="color:#bf616a;">$</span><span> git clone https://github.com/VundleVim/Vundle.vim
</span><span style="color:#bf616a;">$</span><span> git clone https://github.com/junegunn/vim-plug
</span><span style="color:#bf616a;">$</span><span> git clone https://github.com/Shougo/dein.vim
</span></code></pre>
<p>显然，这些插件应该归于 <code>opt/</code> 类，不能在启动时加载。</p>
<p>事实上，对个人用户而言，始终建议将下载的第三方插件安装在 <code>opt/</code> 子目录下。否则
，启动时自动加载的 <code>start/</code> 插件可能太分散，也不利于维护。自己写的插件，放在
<code>start/</code> 相对来说更为稳妥可信，但为了统一，也建议就放 <code>opt/</code> 。确定需要启动加
载的，就在 <code>vimrc</code> 中显式地用 <code>:packadd</code> 列出来。或者可以将这样的一份插件列表
单独放在 <code>~/.vim/plugin/loadpack.vim</code> 脚本中：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>packadd plugin-name</span><span style="color:#d08770;">1
</span><span>packadd plugin-name</span><span style="color:#d08770;">2
</span><span style="color:#b48ead;">...
</span></code></pre>
<p>可见，这样的一份插件列表，就很接近 vim-plug 管理工具要求的 <code>:Plug</code> 配置列表了
，只是没有下载功能而已。也许将来，会有配合内置 package 的插件管理工具，用来增
补自动下载的功能，供用户多个选择。</p>
<p>只是 package 方案出炉略晚，很多用户已经习惯了 vim-plug 这类的插件管理方式，短
时间内不会转到内置 package 来。但是之前 pathogen 的用户，强烈建议改用 package 包管
理机制。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
