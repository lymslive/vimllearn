<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>2.2 选择与比较</h1>
    <!-- ## 2.2 选择与比较 -->
<p>vim 在执行脚本时，一般是按顺序逐条语句执行的。但如果只能像流水帐地顺序执行，未
免太无趣了，功能也弱爆了。本节介绍顺序结构之外的最普遍的选择分支结构，它可以根
据某种条件有选择地执行或不执行语句块（一条或多条语句）。</p>
<p>在 VimL 中通过 <code>:if</code> 命令来表示条件选择，其基本语法结构是：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">if</span><span> {expr}
</span><span>:     </span><span style="color:#65737e;">&quot; todo
</span><span>: </span><span style="color:#b48ead;">endif
</span></code></pre>
<p>如果满足表达式 <code>{expr}</code> ，或说其值为“真”，则执行其后至 <code>:endif</code> 之间的语句。貌
似突然迸进了许多新概念，得先理一理。</p>
<h3 id="biao-da-shi-yu-yu-ju">表达式与语句</h3>
<p>什么叫表达式？这可难说了。我只能先描叙下在 VimL 中什么是与什么不是表达式：</p>
<ul>
<li>单独的变量就是表达式，常量也是表达式，选项值（<code>&amp;option</code>）也是，但选项本身不是；</li>
<li>函数调用是表达式；</li>
<li>表达式有值，表达式之间的合法运算的结果也还是表达式。</li>
<li>但表达式不是可执行语句，它只是语句的一部分。</li>
</ul>
<p>至于语句，在第一章也讲过。VimL 语句就是 Vim 的 ex 命令行。笼统地说，有时说到
<code>ex 命令</code> 是指整个命令行，不过狭义地说，是指它第一个单词所指代的关键命令。于是
，VimL 语言的大部分语句，可认为遵循以下范式：</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>VimL 语句 = ex 命令 + 表达式
</span></code></pre>
<p>为什么说大部分呢？因为我们已经很熟悉的赋值语句如 <code>:let i=1</code> 就不完全适合。在这
里，<code>:let</code> 是个命令，<code>1</code> 是个表达式。但 <code>=</code> 只是依附于 <code>:let</code> 命令的特殊语义符
号，它不是个表达式，也不是个运算符。变量 <code>i</code> 在被创建之前，也还算不上表达式。
而 <code>i=1</code> 写在一起，或为了增加可读性加些空白 <code>i = 1</code>，它也不是表达式，因为它没
有值，（并不能像 C 语言那样使用连等号赋值），下面这两个语句是非法的：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> i = j = </span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">let</span><span> i = (j = </span><span style="color:#d08770;">1</span><span>)
</span></code></pre>
<p>在 VimL 中的常用语句中，除了这个基础得有点平淡无奇的赋值语句，其他大多是
<code>命令 + 表达式</code> 范式的。比如已经大量使用的 <code>:echo</code> 语句，以及上节介绍过的给列
表添加一个元素的函数调用语句 <code>:call add(list, item)</code> 。</p>
<p>然而，其实也不必太拘泥于这些概念名词。理解就好。我们归纳出概念也不外是为了更好地
理解。</p>
<h3 id="luo-ji-zhi-yu-tiao-jian-biao-da-shi">逻辑值与条件表达式</h3>
<p><code>:if</code> 命令（以及下一节要介绍的 <code>:while</code>命令）后面的表达式，就是一个条件表达式
。它期望这个表达式的值的类型是逻辑值，即 <code>type()</code> 的结果是 <code>v:t_bool(=6)</code> 的值
。如果值的类型不是逻辑值，则会自动将其他值转换为一个逻辑值。逻辑类型只有唯二的
两个值，<code>v:true</code> 表示真，<code>v:false</code> 表示假。</p>
<p>所以关键在于 VimL 如何判定其他值是否有真假，什么是真，什么是假？其转换规则如何？
这直接写代码测试一下吧：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">if </span><span style="color:#d08770;">1</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#d08770;">0</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#d08770;">-1</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#a3be8c;">&#39;0&#39;</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#a3be8c;">&#39;1&#39;</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#a3be8c;">&#39;&#39;</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#a3be8c;">&#39;a&#39;</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">23</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif</span><span> |</span><span style="color:#65737e;">&quot; 非法用法
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#d08770;">0</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">23</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif</span><span> |</span><span style="color:#65737e;">&quot; 非法用法
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#a3be8c;">&#39;0.23&#39;</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if </span><span style="color:#a3be8c;">&#39;1.23&#39;</span><span> | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>
</span><span style="color:#65737e;">&quot; 以下四条也都是非法用法
</span><span>: </span><span style="color:#b48ead;">if</span><span> [</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>] | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if</span><span> [] | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if</span><span> {</span><span style="color:#a3be8c;">&#39;x&#39;</span><span>:</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#a3be8c;">&#39;y&#39;</span><span>:</span><span style="color:#d08770;">2</span><span>} | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if</span><span> {} | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span></code></pre>
<p>注：由于语句比较简单，就将 <code>:if</code> 与 <code>:endif</code> 直接写在一行了，用 <code>|</code> 分隔子语句
。正常代码建议写在不同行上且缩进布局。</p>
<p>结果归纳于下：</p>
<ul>
<li>数字 <code>0</code> 为假，其他正数或负数为真；</li>
<li>字符串先自动转为数字，转为 <code>0</code> 的话认为假，能转为其他数字认为真；</li>
<li>浮点数不能转为逻辑值，无法判断真假；</li>
<li>列表与字典也不能直接判断真假。</li>
</ul>
<p>其实可进一步归纳为一句话，在 VimL 中，只能对整数值判断真假，<code>0</code> 是假的，其他都
是真的，字符串先自动转为数字再判断真假。其他类型的值不能直接判断真假。（至
vim8.0 版本是此规则，后面是否会改就不得而知了）</p>
<p>然而，我们还是经常需要判断其他类型的值的某种状态。这时可以利用一个内建函数
<code>empty()</code> 来帮忙。它可以接收任何类型的一个参数，如果它是“空”的，就返回真（
<code>v:true</code>），否则返回假（'v:false'）。在很大程度上，它可以代替直接使用 <code>:if</code> 的
条件表达式，只不过在值上恰好是逻辑取反；优点则是写法统一，适用于所有类型。</p>
<p>在上面这个例子中，可以都再次尝试把 <code>:if</code> 后面的表达式作为 <code>empty()</code> 的参数执
行看看结果，或用 <code>!empty()</code> 取反判断，如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">empty</span><span>(</span><span style="color:#a3be8c;">&#39;0.23&#39;</span><span>) | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#b48ead;">if</span><span> !</span><span style="color:#8fa1b3;">empty</span><span>(</span><span style="color:#a3be8c;">&#39;a&#39;</span><span>) | </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">v:true</span><span> | </span><span style="color:#b48ead;">endif
</span></code></pre>
<p>综合建议：用 <code>:if !empty({expr})</code> 代替 <code>:if {expr}</code>，避免逻辑烧脑，并且大部分
情况下应该是你想要的。</p>
<h3 id="bi-jiao-yun-suan-fu">比较运算符</h3>
<p>两个整数进行相等性的比较，或大小性的比较，结果返回一个或真或假的逻辑值。整数支持
的比较运算符包括：<code>==</code>, <code>!=</code>，<code>&gt;</code>，<code>&gt;=</code>，<code>&lt;</code>，<code>&lt;=</code>。</p>
<p>浮点数支持与整数相同的比较运算，但由于浮点误差，不建议用相等性判断。</p>
<p>字符串也支持与整数相同的那六个比较运算。虽然整数在直接 <code>:if</code> 命令中自动转为数
字处理，但在比较运算中表现良好，就是按正常的编码序逐字符比较。不过有一点特别要
注意的是，字符串比较结果受选项 <code>&amp;ignorecase</code> 的影响，即有可能按忽略大小写的方
式来比较字符串。比如，观察一下如下结果吧：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">set</span><span> ignorecase
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;abc&#39; </span><span style="color:#b48ead;">== </span><span style="color:#a3be8c;">&#39;ABC&#39;
</span><span>: </span><span style="color:#96b5b4;">set</span><span> noignorecase
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;abc&#39; </span><span style="color:#b48ead;">== </span><span style="color:#a3be8c;">&#39;ABC&#39;
</span></code></pre>
<p>因此，为了使比较结果不受用户个人的 <code>vimrc</code> 配置 <code>&amp;ignorecase</code> 的影响，VimL 另
外提供两套限定大小写规则的比较运算符。在以上比较运算符之后再加 <code>#</code> 符号就表示
强制按大小写敏感方式比较，后面加上 <code>?</code> 符号就表示强制按大小写不敏感的方式比较
。比如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;abc&#39; </span><span style="color:#b48ead;">==# </span><span style="color:#a3be8c;">&#39;ABC&#39;
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;abc&#39; </span><span style="color:#b48ead;">==? </span><span style="color:#a3be8c;">&#39;ABC&#39;
</span></code></pre>
<p>所以，强烈建议在进行字符串比较时，只用 <code>==#</code> 或 <code>==?</code> 系的比较运算符。当然由于
弱类型，字符串变量与数字变量其实是不可分的，所以将 <code>==#</code> 或 <code>==?</code> 之类的运用于
数字上比较，也是完全没有关系的。</p>
<p>此外，字符串除了相等性比较，还有匹配性比较，即用 <code>=~</code> <code>!~</code> 运算符判断一个字符
串是否匹配另一个作为正则表达式的字符串。正则表达式是另一个高级话题，这里不再展
开。当然，匹配运算符也有限定大小写是否敏感的衍生运算符，而且一般建议用 <code>=~#</code>
与 <code>!~#</code> 匹配，毕竟正则表达本身有表达大小写的能力。</p>
<p>对于列表与字典变量，可进行相等性比较，但不能进行大小性比较。如果两个列表或字典
的对应元素都相等，则认为它们相等。此外，列表与字典还另外有个同例性比较运算符，
<code>is</code> 或 <code>isnot</code>。注意，这两个是类似 <code>==</code> 的运算符号，不是关键词，虽然它们用英
文单词来表示。同样地，也有 <code>is#</code> 与 <code>isnot?</code> 的衍生运算，不过这主要为了语法的
统一整齐，其实 <code>is#</code> <code>is?</code> 与 <code>is</code> 的结果是一致的。同例性比较的具体含义涉及实
例引用的概念，这留待后面的章节继续展开。</p>
<h3 id="luo-ji-yun-suan-fu">逻辑运算符</h3>
<p>在 VimL 中的逻辑值所支持的或、且、非运算并无意外，分别用符号 <code>||</code> <code>&amp;&amp;</code> <code>!</code> 表
示就是，而且也支持短路计算特性。</p>
<ul>
<li>或 <code>expr1 || expr2 </code>, 只要 <code>expr1</code> 或 <code>expr2</code> 其中一个是真，整个表达式就是真
，两个都是假才是假。如果 <code>expr1</code> 已经是真的，<code>expr2</code> 不必计算就直接获得真的
结果。</li>
<li>且 <code>expr1 &amp;&amp; expr2</code>，只有两个表达式都是真，结果才是真。如果 <code>expr1</code> 是假，则
不必计算 <code>expr2</code> 就返回结果假。</li>
<li>非 <code>!expr</code> ，对表达式真假取反。</li>
</ul>
<h3 id="if-fen-zhi-liu-cheng">if 分支流程</h3>
<p>在了解这些逻辑值判断之后，理解 <code>:if</code> 的选择分支语句就容易多了，其完整语法结构
如下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">if</span><span> {expr}
</span><span>:     {block_if}
</span><span>: </span><span style="color:#b48ead;">elseif</span><span> {expr}
</span><span>:     {block_elseif}
</span><span>: </span><span style="color:#b48ead;">elseif</span><span> {expr}
</span><span>:     {block_elseif}
</span><span>: </span><span style="color:#b48ead;">......
</span><span>: </span><span style="color:#b48ead;">else
</span><span>:     {block_else}
</span><span>: </span><span style="color:#b48ead;">endif
</span></code></pre>
<ul>
<li>首先执行的是 <code>:if</code> 后面的 <code>{expr}</code> 表达式，它可能只是个简单表达式，也可能是
多个逻辑值的复合运算，或者是很多表达式运算后得到的一个数字结果或逻辑值。只要
它最终能被解释为真，就执行其后的 <code>{block_if}</code> 语句块。</li>
<li>如果 <code>:if</code> 的表达式为假，则依次寻找下一个表达式为真的 <code>:elseif</code> 语句块。</li>
<li>最后如果没有真的 <code>:if</code> 与 <code>:elseif</code> 条件满足，就执行 <code>:else</code> 语句块。</li>
<li>只有 <code>:if</code> 与 <code>:endif</code> 关键命令是必须的，<code>:elseif</code> 与 <code>:else</code> 及其语句块是可
选的。</li>
<li>在任一条件下，最多只有一个语句块被执行，然后流程跳转到 <code>:endif</code> 之后，结束整
个选择分支流程。</li>
<li>如果没有 <code>:else</code> 语句块，则在没有任何一个条件满足时，就不会执行任何一个语句块
。在有 <code>:else</code> 时，则至少会执行一个语句块。</li>
</ul>
<p>注意：<code>elseif</code> 是直接将 <code>else</code> 与 <code>if</code> 这两个单词拼在一起的，中间没有空格，也
没有缩写。在许多不同的语言中，<code>else if</code> 的写法可能是变化最多的。</p>
<p>在 VimL 中，目前也没有 <code>switch case</code> 的类似语句，如果要实现多分支，只能叠加
<code>:elseif</code>。</p>
<p>在非常简单的 <code>if else endif</code> 语句中，也可以用条件表达式 <code>expr1 : expr2 ? expr3</code>，
这类似于：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">if</span><span> expr</span><span style="color:#d08770;">1
</span><span>:     expr</span><span style="color:#d08770;">2
</span><span>: </span><span style="color:#b48ead;">else
</span><span>:     expr</span><span style="color:#d08770;">3
</span><span>: </span><span style="color:#b48ead;">endif
</span></code></pre>
<p>整个表达式的值是 <code>expr2</code> 或 <code>expr3</code> 的值。至于条件表达式是否可以嵌套，这个我也
不知道，反正我不用，也不建议用。就是条件表达式本身，也只推荐在一些有限的场合用
，不推荐大量使用。因为一开始以为简单的逻辑判断，也可能以后会被修改的复杂起来，
仍然是用 <code>:if</code> 清晰一些。</p>
<p>然后推荐 <code>:if</code> 的一个特殊技法。VimL 并没有块注释，但是可以把多行语句嵌套放在
<code>:if 0 ... :endif</code> 之间，然后其内的语句就完全不会被执行了，甚至有不合 VimL 语
法的行也没事。然而仍然只建议这样“注释”合法的语句行，因为 <code>:if 0</code> 的潜意识是在
某个时刻可能需要将其改为 <code>:if 1</code> 以重新激活语句。这主要是用于更方便地切换测试
某块语句的运行效果。</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">if </span><span style="color:#d08770;">0
</span><span>:     这里被注释了
</span><span>: </span><span style="color:#b48ead;">endif
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;done&#39;
</span></code></pre>
<h3 id="yun-suan-fu-you-xian-ji">*运算符优先级</h3>
<p>本节为讲叙选择分支语句，也引申讲了不少有关语句、表达式、运算符的相关问题。落到
实处就是各种运算符的使用了，这就需要特别注意运算符的优先级问题。在此并不打算罗
列 VimL 的运算符优先级表，因为到这里可能还有些内容未覆盖到。而且运算符优先级的
问题太过琐碎，只看一遍教程并无多大助益，需要经常查文档，并自行验证。可以通过这
个命令 <code>:help expression-syntax</code> 查看表达式语法表，其中也基本是按运算符优先级
从低到高排列的，请经常查阅。</p>
<p>虽然由于运算符优先级会引起一些自己意想不到的问题，但回避这类问题的办法也是很简
单的，这里是一些建议：</p>
<ul>
<li>首先按自己的理解去使用运算符，要相信大部分语言的设计都是人性化的，不会故意设
些奇怪的违反常理的规则。</li>
<li>对于自己不确定优先级，或者发现运算结果不符合自己所想时，添加小括号组合，使表
达式运算的次序明确化。</li>
<li>拆分复杂表达式，借助中间变量，写成多行语句，不要写过长的语句。</li>
</ul>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
