<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>2.1 变量与类型</h1>
    <!-- ## 2.1 变量与类型 -->
<p>VimL 语言的变量规则与其他大多数语言一样，可以（只允许）由字母、数字与下划线组
成，且不能以数字开头。特殊之处在于还可以在变量名之前添加可选的作用域前缀，如
<code>g: l: s: b: w: t:</code>（<code>a:</code>又有点特殊，在定义函数参数时不要前缀，而在使用参数时
需要前缀），这在第一章有专门讨论，此不再叙说。</p>
<p>VimL 所支持的变量（值）类型可由帮助（<code>:help type()</code>）查看。其中最主要最常用的
有数字（number）、字符串（string）、列表（list）与字典（dictionary）四种，或者
可以再进一步归纳为三种，因为前两种（数字与字符串）在绝大数情况下自动转换，在使
用时几乎不必考虑其类型差别，只须知道它表示“一个值”，所以也称作标量。而列表与字
典变量则是“多个值”的集合，所不同在于获取其中某个值的索引方式不同。</p>
<h3 id="biao-liang-shu-zi-yu-zi-fu-chuan">标量：数字与字符串</h3>
<p>数字是（number）直译，其实就是其他大多数语言所称的整数（int）。数字是有符号的
，包括正负数与 0 ，其取值范围与 Vim 的编译版本有关。经笔者的测试，vim8.0 支持
8 字节的有符号整数，低版本只支持 4 字节的有符号整数。数字经常（或常规功能）是
用于命令的地址参数表示行号，或命令的重复次数，一般情况下不必考虑数字溢界的问题
。当你需要用到 VimL 来表达很大的整数时，才要小心这个潜在的问题。</p>
<p>字符串也简单，用单引号或双引号括起来即可，它们的语义是完全一致的。不过有以下使
用建议原则：</p>
<ul>
<li>一般使用单引号表示字符串，如 <code>'string'</code>，毕竟双引号还可用于行末注释，尽量避
免混淆。</li>
<li>如果需要使用转义如 <code>\n</code> <code>\t</code>，则使用双引号，单引号不支持转义。</li>
<li>如果字符串包含一种引号，则使用另一种引号括起整个字符串。</li>
<li>如果有包含一层引用，则内外层用不同的引号。</li>
</ul>
<p>数字变量支持常见的数学运算（加减乘除模，<code>+-*/%</code>），字符串只支持连接运算符，用
点号（<code>.</code>）表示。此外，一些内建函数与命令也会要求其参数是数字或字符串。也就是
数字与字符串有不同的使用环境，VimL 便能依据上下文环境将数字或字符串进行自动转
换，规则如下：</p>
<ul>
<li>数字转字符串表示是显而易见的，就是十进制数的10个数字字符表示法；</li>
<li>字符串转数字时，只截前面像数字的子串，若不以数字字符开头，则转为数字 0 。</li>
</ul>
<p>请测试：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;sring&#39; </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">123
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;123&#39;
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;123&#39;</span><span> + </span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;123string&#39;</span><span> + </span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;1.23string&#39;</span><span> + </span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;string123&#39;</span><span> + </span><span style="color:#d08770;">1
</span></code></pre>
<p>需要特别注意的是字符串 <code>'1.23'</code> 只会自动转为字数 <code>1</code> ，而不是浮点数 <code>1.23</code>。</p>
<p>在 VimL 中输入数字常量时，也支持按二进制、八进制、十六进制的表示法，不过自动转
字符串时只按十进制转换。请自行观察以下结果，如果不懂其他进制可无视。</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">0</span><span>xff
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">020
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">0</span><span>b</span><span style="color:#d08770;">10
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">0</span><span>b</span><span style="color:#d08770;">10</span><span> + </span><span style="color:#d08770;">3
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;string&#39; </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">0</span><span>xff
</span></code></pre>
<h3 id="lie-biao-you-xu-ji-he">列表：有序集合</h3>
<p>列表，在其他语言中也有的叫数组，就是许多值的有序集合。VimL 的列表有以下要点：</p>
<ul>
<li>创建列表语法, 中括号整体，逗号分隔元素： <code>:let list = [0, 1, 2, 3]</code></li>
<li>用中括号加数字索引访问元素：<code>:echo list[1]</code></li>
<li>索引从 0 开始，支持负索引，-1 表示最后一个元素，访问不存在索引时报错。</li>
<li>索引也可以用整数变量。</li>
<li>不限长度，在需要时会自动扩展容量。</li>
</ul>
<p>在列表创建后，用内建函数 <code>add()</code> 与 <code>remove()</code> 动态增删元素，用 <code>len()</code> 函数取
得列表长度（元素个数）。例如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> list = [</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>]
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> list
</span><span>: call </span><span style="color:#8fa1b3;">add</span><span>(list, </span><span style="color:#d08770;">4</span><span>)
</span><span>: call </span><span style="color:#8fa1b3;">add</span><span>(list, </span><span style="color:#d08770;">5</span><span>)
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> list
</span><span>: call </span><span style="color:#8fa1b3;">remove</span><span>(list, </span><span style="color:#d08770;">-1</span><span>) | </span><span style="color:#96b5b4;">echo</span><span> list
</span><span>: call </span><span style="color:#8fa1b3;">remove</span><span>(list, </span><span style="color:#d08770;">1</span><span>) | </span><span style="color:#96b5b4;">echo</span><span> list
</span></code></pre>
<h3 id="zi-dian-wu-xu-ji-he">字典：无序集合</h3>
<p>字典，在其他语言中可能叫 Hash 表或散列表，就是许多“键-值”对的集合。与列表最大
的不同在于，它不是用数字索引来访问其内的元素，而是用字符串索引（键）来访问元素
。字典在内部存储方式是无序的，但通过键访问元素的速度极快。</p>
<p>定义与使用字典的语法示例如下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> dict = {</span><span style="color:#a3be8c;">&#39;x&#39;</span><span>: </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#a3be8c;">&#39;y&#39;</span><span>: </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#a3be8c;">&#39;z&#39;</span><span>: </span><span style="color:#d08770;">3</span><span>,}
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> dict
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> dict[</span><span style="color:#a3be8c;">&#39;x&#39;</span><span>]
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> dict</span><span style="color:#b48ead;">.</span><span>y
</span><span>: </span><span style="color:#96b5b4;">let</span><span> var = </span><span style="color:#a3be8c;">&#39;z&#39;
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> dict[var]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> dict[</span><span style="color:#a3be8c;">&#39;u&#39;</span><span>] = </span><span style="color:#d08770;">4
</span><span>: </span><span style="color:#96b5b4;">let</span><span> dict</span><span style="color:#b48ead;">.</span><span>v = </span><span style="color:#d08770;">5
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> dict
</span></code></pre>
<p>语法要点：</p>
<ul>
<li>字典用大括号 <code>{}</code> 括号整体。</li>
<li>每个键值对用逗号分隔，键与值用冒号分隔，键一般有引号表字符串。</li>
<li>大括号内的空白是可选的，最后一个逗号也是可选的。</li>
<li>访问字典内某个元素时，仍是中括号 <code>[]</code> 索引，键放在中括号中。</li>
<li>在创建字典或访问元素时，键既可用引号引起的常量字符串，也可用字符串变量，数字
变量自动转换为字符串。</li>
<li>当一个键是普通常量字符串（可用作变量名的字符串）时，可不用中括号加引号索引，
而简洁地用点号索引，二者等价。</li>
<li>不能访问不存在的键，否则报错。</li>
<li>能直接对不存在的键赋值，表示对字典增加一个键值对元素。</li>
</ul>
<h3 id="shan-chu-bian-liang">删除变量</h3>
<p>创建（或叫定义）变量用 <code>:let</code> 命令，相应的也就有 <code>:unlet</code> 命令用于删除一个变量
。一般情况下没必要删除一个标量，因为它也占不了多少内存，需要重定义时也可以重新
赋值。但对于列表与字典，有时比较在意其集合意义，可以用 <code>:unlet</code> 删除其中一个值
，加上对应的索引即可，如果不加索引，则表示删除整个列表或字典。</p>
<p>例如：假设 <code>list</code> 与 'dict' 变量已如上定义：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: unlet list[</span><span style="color:#d08770;">1</span><span>] | </span><span style="color:#96b5b4;">echo</span><span> list
</span><span>: unlet list[</span><span style="color:#d08770;">-1</span><span>] | </span><span style="color:#96b5b4;">echo</span><span> list
</span><span>: unlet dict[</span><span style="color:#a3be8c;">&#39;u&#39;</span><span>] | </span><span style="color:#96b5b4;">echo</span><span> dict
</span><span>: unlet dict</span><span style="color:#b48ead;">.</span><span>v | </span><span style="color:#96b5b4;">echo</span><span> dict
</span></code></pre>
<p>如果要删除的变量或字典（列表）不存在的索引，<code>:unlet</code> 会报错。如果想绕过该错误
检测，则可用 <code>:unlet!</code> 命令。</p>
<p>在 vim8.0 版本之前，标量、列表、字典三者是不互通的。如果 <code>list</code> 已被定义成了一
个列表变量，那么它就不能用 <code>:let</code> 重赋值为一个字典或字符串或其他什么，但允许重
赋值为另一个列表变量。如果一定要改变 <code>list</code> 的变量类型，只能先 <code>:unlet</code> 它，再
重新 <code>:let</code> 它为其他任意变量。</p>
<p>在 vim8.0 版本之后，不再有这个限制，不会再报诸如“类型不匹配”的错误了，更好地体
现了动态弱类型的特点。然而，良好的命名规范要求变量名望文生义，在同一个范围的同
一个变量名，前后用之于表达完全不同类型的变量，并不是个好习惯。</p>
<h3 id="fu-dian-shu">浮点数</h3>
<p>虽然浮点数在 VimL 中用的比较少，但毕竟还是支持的。</p>
<ul>
<li>浮点数也叫小数，支持科学记数法。</li>
<li>数字（整数）可自动转为浮点数。</li>
<li>浮点不能自动转为整数，也不能自动转为字符串。</li>
<li>整数运算结果仍是整数，浮点数运算结果仍是浮点数。</li>
<li>浮点数取整后仍是浮点数，不是整数。</li>
</ul>
<p>请看以下示例：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">23</span><span>e</span><span style="color:#d08770;">3
</span><span>: </span><span style="color:#96b5b4;">let</span><span> int = </span><span style="color:#d08770;">123</span><span> | </span><span style="color:#96b5b4;">let</span><span> float = </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">23</span><span> | </span><span style="color:#96b5b4;">let</span><span> str = </span><span style="color:#a3be8c;">&#39;string&#39;
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str </span><span style="color:#b48ead;">.</span><span> int
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str </span><span style="color:#b48ead;">.</span><span> float |</span><span style="color:#65737e;">&quot;错误
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">5</span><span> / </span><span style="color:#d08770;">3
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">5 </span><span style="color:#b48ead;">% </span><span style="color:#d08770;">3
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">5</span><span> / </span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span> |</span><span style="color:#65737e;">&quot;错误
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">5 </span><span style="color:#b48ead;">% </span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span> |</span><span style="color:#65737e;">&quot;错误
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">5</span><span>/</span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>)
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">5</span><span>/</span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>) </span><span style="color:#b48ead;">== </span><span style="color:#d08770;">2
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">5</span><span>/</span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>) </span><span style="color:#b48ead;">.</span><span> str |</span><span style="color:#65737e;">&quot;错误
</span></code></pre>
<p>最后一行语句说明，虽然一个浮点数取整后看似与一个整数相等，但它仍然不是整数，所
以不能与字符串自动连接。</p>
<p>要将一个字符串“显式”转换为整数，可以与 <code>0</code> 相加；同理，要将整数“显式”转换为字
符串，可与空串 <code>&quot;&quot;</code> 相连接。VimL 还提供了另一个内建函数 <code>string()</code> 将任意其他
类型转换为可打印字符串。于是，想将一个浮点数转换为“真正”的整数，可用如下操作：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">0</span><span> + </span><span style="color:#8fa1b3;">string</span><span>(</span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">5</span><span>/</span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>))
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">type</span><span>(</span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">5</span><span>/</span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>))
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">type</span><span>(</span><span style="color:#d08770;">0</span><span> + </span><span style="color:#8fa1b3;">string</span><span>(</span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">5</span><span>/</span><span style="color:#d08770;">3</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>)))
</span></code></pre>
<p>注：行末注释可用一个双引号 <code>&quot;</code> 开始，但建议用 <code>|&quot;</code> 更有适用性。<code>|</code> 表示分隔语
句，只是后面一个语句是只有注释的空语句。</p>
<h3 id="lei-xing-pan-duan">类型判断</h3>
<p>从 Vim8.0 开始，有一系列 vim 变量专门地用来表示各种变量（值）类型。比如
<code>v:t_list</code> 表示列表类型。如果要判断一个变量是否为列表类型，可用以下三种写法中任
何一种（但之前的低版本 Vim 只能用后两种）：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">type</span><span>(var) </span><span style="color:#b48ead;">== </span><span style="color:#bf616a;">v:t_list
</span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">type</span><span>(var) </span><span style="color:#b48ead;">== </span><span style="color:#d08770;">3
</span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">type</span><span>(var) </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">type</span><span>([])
</span></code></pre>
<p>关于具有选择分支功能的 <code>:if</code> 语句，在下一节继续讲解。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
