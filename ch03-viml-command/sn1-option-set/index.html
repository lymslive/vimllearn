<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>3.1 选项设置</h1>
    <!-- ## 3.1 选项设置 -->
<h3 id="xuan-xiang-fen-lei-yu-she-zhi-ming-ling">选项分类与设置命令</h3>
<p>设置选项的命令是 <code>set</code>。根据选项值的不同情况，可以将选项分为以下三类：</p>
<ol>
<li>不需要值的选项，或者说是 bool 型的开关切换状态的选项。这种选项有两个相对立
的选项名，分别用命令 <code>:set option</code> 表示开启选项，<code>:set nooption</code> 表示关闭选
项。例如 <code>:set number</code> 是设置显示行号，<code>:set nonumber</code> 是设置不显示行号。</li>
<li>选项有一个值。用命令 <code>:set option=value</code> 设定该类选项的值。选项值可以是数字
或字符串，但字符串的值也不能加引号，就按字面字符串理解。也就是说，<code>:set</code> 后
面的参数，不是 VimL 的表达式，与 <code>:let</code> 命令有根本的不同。这个命令更像是
<code>shell</code> 设置变量的语法，<code>=</code> 前后也最好不要用空格。</li>
<li>选项允许有多个值，值之间用逗号分隔。设置命令形如 <code>:set option=val1,val2</code>。
此外还支持 <code>+=</code> 增量与 <code>-=</code> 减量语法，如 <code>:set option+=val3</code> 或 <code>:set option-=val2</code>，表示在原来的“值集合”的基础上增加某个值或移除某个值。</li>
</ol>
<h3 id="xuan-xiang-zhi-bian-liang">选项值变量</h3>
<p>在选项名前面加个 <code>&amp;</code> 符号，就将一个选项变成了相应的选项值变量。例如，以下两条
命令是等效的：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">set</span><span> option=value
</span><span>: </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">&amp;option</span><span> = value
</span></code></pre>
<p>与普通变量赋值一样，<code>=</code> 前后的空格是可选的，这里的空格只是一种编程习惯，为增加
可读性。另外有以下几点要注意：</p>
<ol>
<li>第一类选项，在用 <code>:set</code> 命令时不需要等号，但是用 <code>:let &amp;</code> 命令时也要用等号将
其值赋为 1 或 0，分别表示开启选项与关闭选项。同时 <code>&amp;</code> 只允许作用在没有 <code>no</code>
前缀的选项之前。比如 <code>:let &amp;nonumber = 1</code> 是非法的，只能用 <code>:let &amp;number = 0</code> 
表示相同意图。</li>
<li>第二类选项，如果值是字符串，用 <code>:let &amp;</code> 命令时要将值用引号括起来，也就像普
通变量赋值一样，要求等号后面是合法的表达式。</li>
<li>第三类选项，它的值也是一个由逗号分隔的（长）字符串，比如 <code>:echo &amp;rtp</code>。并不
能由于这类选项支持多个值就将 VimL 的列表赋给它，不过很容易通过 <code>split()</code> 函
数从这类选项值中分隔出一个列表。</li>
</ol>
<p>备注：选项设置 <code>:set</code> 应是历史渊源最早的命令之一吧。而 <code>:let</code> 是后来 VimL 语言
发展丰富起来提供的命令。两者有不一样的语法，所以又提供了这种等价转换方法。</p>
<h3 id="vimrc-pei-zhi-quan-ju-xuan-xiang">vimrc 配置全局选项</h3>
<p>严格地说，<code>:set</code> 是设置全局选项的命令。既是影响全局的选项，一般是要第一时间在
<code>vimrc</code> 中配置的。最重要的是以下两条配置：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">set</span><span> nocompatible
</span><span>: </span><span style="color:#96b5b4;">filetype</span><span> plugin indent on
</span></code></pre>
<p>第一条配置是说不要兼容 <code>vi</code>，否则可能有很多 <code>vim</code> 的高级功能用不了。第二条配置
（虽然不是 <code>set</code> 选项）是用 Vim 编写程序源代码必要的，意思是自动检测文件类型，
加载插件，自动缩进的意思。除非在很老旧的机器上，或为了研究需要，一般都没理由不
加上这两条至关重要的配置。</p>
<p>下面再介绍一些比较重要的几类配置选项，当然这远远不够全面。查看选项的帮助命令是
<code>:help options</code>，查看某一个选项的帮助是在用单引号括起选项名作为帮助参数，例如
<code>:help 'option'</code>。查看某个选项的当前值是命令 <code>:set option?</code> 或 <code>:echo &amp;option</code>
。</p>
<ul>
<li>
<p>编码相关：encoding fileencodings fileencoding</p>
<ul>
<li>encoding 是 Vim 内部使用的编码。建议 <code>:set encoding=utf-8</code>。</li>
<li>fileencodings 是打开文件时，Vim 用于猜测检测文件编码的一个编码列表。对中文
用户，建议 <code>:set fileencodings=ucs-bom,utf-8,gb18030,cp936,latin1</code>。</li>
<li>fileencoding （局部选项），当前文件的编码，如果与 encoding 不同，在写入时
自动转码。用户一般不必手动设这个选项，除非你想用另外一种编码保存文件。</li>
</ul>
</li>
<li>
<p>外观相关：number/relativenumber wrap statusline/tabline</p>
<ul>
<li>number 是在窗口左侧加一列区域显示行号，relativenumber 显示相对行号，即相对
光标所在的行的行号，当前行是 0，上面的行是负数，下面的行是正数。</li>
<li>wrap 是指很长的文本行折行显示。一般良好风格的程序源文件不应出现长行，但
Vim 作为通用文件编辑器，不一定只用于编辑程序。</li>
<li>statusline 是定制状态栏，格式比较复杂，建议查看文档，也有些插件提供了很炫
酷的状态栏。tabline 的定制格式与状态栏一样，在开多个标签页时才生效。</li>
<li>laststatus 什么时候显示状态栏，建议用值 <code>2</code> 表示始终显示状态栏。</li>
<li>cmdheight 命令行的高度，默认只有 1 行太少，当命令行有输出时可能经常要多按
一个回车才回到普通模式。建议 2 行，更多就浪费空间了。</li>
<li>wildmenu 这是在编辑命令行时，按补全键后，会临时在状态栏位置显示补全提示。</li>
</ul>
</li>
<li>
<p>GUI外观：只在 gVim 或有 GUI 版本的 Vim 有效</p>
<ul>
<li>guioptions 设置 GUI 各部件（菜单工具栏滚动条等）是否显示。</li>
<li>clipboard 设置剪切板与 Vim 的哪个寄存器关联。</li>
</ul>
</li>
<li>
<p>颜色主题：</p>
<ul>
<li>colorscheme 这是个单独的命令，不是 <code>set</code> 选项。选择一个颜色主题。颜色主题
是放在运行时各路径的 <code>colors/</code> 子目录的 <code>*.vim</code> 文件。</li>
<li>background 背景是深色 <code>dark</code> 或浅色 <code>light</code>。有的 colorscheme 只适于深色或
浅色背景，有的则分别为不同背景色定义不同的颜色主题。</li>
<li>term 与 t_Co 有的颜色主题可能还与终端与终端色数量有关。</li>
<li>cursorline 与 cursorcolumn 用不同格式高亮当前行与当前列，具体高亮格式由颜色
主题定义。个人建议只高亮 cursorline 。</li>
<li>hlsearch 高亮搜索结果。</li>
</ul>
</li>
<li>
<p>格式控制：</p>
<ul>
<li>formatoptions 控制自动格式化文本的许多选项，建议看文档。</li>
<li>textwidth 文本行宽度，超过该宽度（默认78）时自动加回车换回。在编辑程序源文
件时可用上个 formatoptions 选项控制只在注释中自动换行但代码行不自动换行。</li>
<li>autoindent smartindent 插入模式下回车自动缩进。</li>
<li>shiftwidth 缩进宽度。</li>
<li>tabstop softtabstop 制表符宽度，软制表符是行首按制符缩进的宽度。一般建议
硬制表符宽度 tabstop 保持 8 不变，用 shiftwidth softtabstop 表示缩进。</li>
<li>expandtab 插入制表符自动转为合适数量的空格。</li>
<li>paste 将 Vim 的插入模式置于“粘贴”模式，从外部复制文本进 Vim 开启该选项可避
免一些副作用。但只建议临时开启该选项。</li>
</ul>
</li>
<li>
<p>路径相关：</p>
<ul>
<li>runtimepath 运行时路径，简称（rtp）。vim 在运行时搜索脚本的一组路径。一般
不手动设置该值，如果有插件管理器管理插件的话。插件必须放在某个 <code>&amp;rtp</code> 路径
下，现在流行的是将插件工程主目录添加至 Vim 的 <code>&amp;rtp</code> 中。</li>
<li>packpath （Vim8开始才支持）动态加载插件的搜索路径，默认是 <code>~/.vim/pack</code>。
插件主目录可置于 <code>{packpath}/{packname}/opt/{plugin}</code>。然后用 <code>:packadd</code>
启用插件。</li>
<li>path 这是 vim 在寻找编辑文件，如 <code>gf</code> <code>:find</code> 等命令时所要搜索的一组目录。</li>
<li>tags 这是 vim 按标签跳转 <code>Ctrl-]</code> 或 <code>:tag</code> 等命令所依据的标签文件，默认是
<code>./tags,tags</code>（相对路径）。一般不建议修改默认值，但可以默认值基础上添加更
多的标签文件，比如编辑一个工程时，将工程主目录下的 tags 文件也加进来。</li>
<li>autochdir 将当前路径自动切换到当前编辑的文件所在的目录。当你依赖一些管理工
程类的插件时，可能要求当前路径锁定在工程主目录，不宜开启该选项。但是个人喜
欢开启这选项，这样在用 <code>:e</code> 命令打开同目录下的其他文件时很方便。</li>
</ul>
</li>
</ul>
<p>Vim 所支持的选项实在是太多了。初学者建议参考前人经验成熟的配置，用 <code>:help</code> 查
看每个选项的具体含义，然后决定这种选项是否适合自己。另外注意有些选项可能要配合
起来才能发挥更好的效果。</p>
<h3 id="viml-kong-zhi-ju-bu-xuan-xiang">VimL 控制局部选项</h3>
<p>局部选项是只影响当前缓冲文件或窗口（buffer/window）的选项。严格来说是局部选项
值，而不是有另外一类选项。默认情况下每个新文件或窗口都继承选项的全局值，但对于
一些选项，可以为该文件或窗口设定一个不同与全局的局部值。然而并不是所有选项都有
局部值意义，在每个选项的帮助文档中，会指明该选项是全局（global）或局部的（
local to buffer 或 local to window）。</p>
<p>设置局部选项（值）用 <code>:setlocal</code> 命令。如果目标选项没有局部值，则等效 <code>:set</code>
命令设置全局值。但是最好不要混用，避免误解。局部选项值变量用 <code>&amp;l:option</code> 表示
。比如 <code>number</code> 行号就是个局部选项：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">set</span><span> nonumber
</span><span>: </span><span style="color:#96b5b4;">setlocal</span><span> number
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">&amp;number
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">&amp;l</span><span style="color:#b48ead;">:</span><span>number
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">&amp;g</span><span style="color:#b48ead;">:</span><span>number
</span></code></pre>
<p>你可以将 vim 分裂出两个窗口（<code>:split</code> 或 <code>:vsplit</code>），在其中一个窗口上执行以上
语句，试试看结果。需要注意的是，虽然局部选项值借用了变量的局部作用域前缀 <code>l:</code>
，但它的默认规则又有点不同。看这里的 <code>&amp;number</code> 是默认的 <code>&amp;l:number</code> 而不是
<code>&amp;g:number</code>。事实上，普通的局部变量 <code>l:var</code> 根本不能在函数外的命令行使用。</p>
<p>当用 VimL 写脚本时，如果要改变选项设置，且该选项支持局部值，最好用 <code>:setlocal</code>
只改变局部值。这也是编程的一大原则，尽量将影响局部化。下面介绍一些比较重要的局
部选项设置：</p>
<ul>
<li>文件类型：filetype
<ul>
<li>大部分情况下，这个选项不用手动设置，也不用脚本显式设置，打开自动检测就可以自
动根据后缀名设置相应的文件类型。不过在创建新的文件类型时，可能需要自己设置
这个选项。</li>
<li>文件类型插件，如 <code>~/.vim/ftplugin/*.vim</code> 脚本内若涉及选项更改，也尽量用
<code>:setlocal</code> 只设局部选项。</li>
</ul>
</li>
<li>缓冲类型：buftype
<ul>
<li>&quot;buffer type&quot; 与 &quot;file type&quot; 是两个不同的概念。缓冲类型更加抽象，是 vim 内
部用于管理缓冲的一些控制属性，而文件类型是着眼于文件内容性质的。</li>
<li><code>buftype</code> 的两个重要的选项值是 <code>nofile</code> 与 <code>nowrite</code>，表示特殊的不用写文件
的 buffer，而这两者又还有细微差别，具体请读文档。</li>
</ul>
</li>
<li>其他 buffer 属性：
<ul>
<li>buflisted 是否将当前缓冲记录在缓冲列表中。</li>
<li>bufhidden 当缓冲不再任一窗口展示，如何处理该缓冲，有几种不同的选项值。</li>
<li>modifiable 当前缓冲是否可修改，包括更改编码与换行符格式也算种修改。</li>
</ul>
</li>
</ul>
<p>由于在 Vim 中，最主要的可见（可编辑）对象就只是 buffer，所以在一些复杂而细致的
插件中，经常会开辟一个辅助窗口，仅为展示辅助内容，这就往往要设置一个特殊的
<code>buftype</code> 及其他一些 buffer 属性。</p>
<p>此外，在脚本中，可能有需求只临时改变某个选项值，处理完毕后再恢复原选项设置，这
就要借且选项值变量了。处理流程大致如下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:save_option</span><span> = </span><span style="color:#bf616a;">&amp;l</span><span style="color:#b48ead;">:</span><span>option
</span><span>: </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">&amp;l</span><span style="color:#b48ead;">:</span><span>option = ? |</span><span style="color:#65737e;">&quot; 或者 setlocal option = ?
</span><span>: </span><span style="color:#65737e;">&quot; do something
</span><span>: </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">&amp;l</span><span style="color:#b48ead;">:</span><span>option = </span><span style="color:#bf616a;">l:save_option
</span></code></pre>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch03-viml-command/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
