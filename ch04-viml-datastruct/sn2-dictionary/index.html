<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>4.2 通用的字典结构</h1>
    <!-- ## 4.2 通用的字典结构 -->
<p>为什么说字典是通用结构。因为在 VimL 中字典是最复杂的内置类型了，而更复杂的数据
结构都能以字典为基础构建出来。不过从基础的概念上理解，字典与列表其实也有些相似
之处，当掌握了列表之后，对字典的用法也就容易了。</p>
<h3 id="zi-dian-yu-lie-biao-de-yi-tong">字典与列表的异同</h3>
<p>在其他一些（脚本）语言中，对应 VimL 的列表与字典的概念，也叫数组与关联数组。所
以字典也可以看成是一种特殊的列表，无序的以字符串为索引的列表。字典的索引也叫键
，在 VimL 中，字典的键只能是字符串，当数字用作字典键时也被隐式转为字符串。其它
类型的值，一般不能用作字典的键。</p>
<p>请看这个示例：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> list = </span><span style="color:#8fa1b3;">range</span><span>(</span><span style="color:#d08770;">10</span><span>)
</span><span>: </span><span style="color:#96b5b4;">let</span><span> dict = {}
</span><span>: </span><span style="color:#b48ead;">for</span><span> i </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">range</span><span>(</span><span style="color:#d08770;">10</span><span>)
</span><span>:     </span><span style="color:#96b5b4;">let</span><span> dict[i] = i
</span><span>: </span><span style="color:#b48ead;">endfor
</span><span>
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;list =&#39;</span><span> list
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;dict =&#39;</span><span> dict
</span><span>
</span><span>: </span><span style="color:#b48ead;">for</span><span> [k, v] </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">items</span><span>(dict)
</span><span>:    </span><span style="color:#96b5b4;">echo</span><span> k v
</span><span>: </span><span style="color:#b48ead;">endfor
</span></code></pre>
<p>用 range() 创建了一个列表 list，包含的元素是 0-9 这十个数字。然后创建了一个空
字典 dict，再用循环为字典增加键值，也用相同的 0-9 这十个数字作为键与值。这样，
在表观上，dict 与 list 似乎保存着相同的元素，用相同的索引能得到相同的值，比如
<code>dict[5]</code> 与 <code>list[5]</code> 都得到数值 <code>5</code>。但通过 <code>:echo dict</code> 可以发现，dict 字典
的键，其实不是数字，而是字符串（<code>'0', '1'</code>等）。</p>
<p>为理解遍历字典的范式 <code>for [k, v] in items(dict)</code>，可先用 <code>echo items(dict)</code> 查
看这是什么。可见 <code>items(dict)</code> 返回一个列表，该列表的每个元素又是个小列表，包
含键与值两个元素。所以你明白了，字典的元素，不像列表的元素那么简单的一个值，而
是一个“键值”对。所谓关联数组名称也源于此，每个键对应一个值。键是唯一的，但值可
不唯一，即不同键可关联相同的值。</p>
<p>在字典循环中，也用到了上节介绍的列表解包的多重赋值的功能，相当于如下语句：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> [k, v] = </span><span style="color:#8fa1b3;">items</span><span>(dict)[</span><span style="color:#d08770;">0</span><span>]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> [k, v] = </span><span style="color:#8fa1b3;">items</span><span>(dict)[</span><span style="color:#d08770;">1</span><span>]
</span><span>: </span><span style="color:#b48ead;">...
</span><span>: </span><span style="color:#96b5b4;">let</span><span> [k, v] = </span><span style="color:#8fa1b3;">items</span><span>(dict)[</span><span style="color:#d08770;">9</span><span>]
</span></code></pre>
<p>也因此，<code>[k, v]</code> 必须用中括号括起来。</p>
<p>在这个特殊的例子中，遍历字典所得的值也许是与列表一样有序。但请记住，字典不保证
有序。同时，在一般应用中，最好不要用连续的数字作为字典的键，那应该直接使用列表
更高效且方便。但如果是很稀疏的有大量空洞的列表，则用字典或许是有意义的。如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> dict[</span><span style="color:#d08770;">10</span><span>] = </span><span style="color:#a3be8c;">&#39;a&#39;
</span><span>: </span><span style="color:#96b5b4;">let</span><span> dict[</span><span style="color:#d08770;">100</span><span>] = </span><span style="color:#a3be8c;">&#39;b&#39;
</span><span>: </span><span style="color:#96b5b4;">let</span><span> dict[</span><span style="color:#d08770;">1000</span><span>] = </span><span style="color:#a3be8c;">&#39;c&#39;
</span></code></pre>
<p>这样，只为 dict 增加了三个元素。但若为 <code>list[1000]='c'</code> 赋值，则会为列表增加
1000 个元素，中间的无用索引都浪费了。</p>
<p>在常用使用字典时，建议用简单字符串索引，所谓简单字符串，即是可充当 VimL 标记符
（变量名）的字符串。这时，字典的中括号索引可用点索引简化写法，即 <code>dict['name']</code>
可简化等效于 <code>dict.name</code>。当索引是一个字符串变量时，用中括号索引更方便，即
<code>dict[varname]</code>。</p>
<p>还有一点需要重点理解的是，字典变量与列表变量一样，是引用而已。请看以下示例：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> d</span><span style="color:#d08770;">1</span><span> = {}
</span><span>: </span><span style="color:#96b5b4;">let</span><span> d</span><span style="color:#d08770;">2</span><span> = {}
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> d</span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">==</span><span> d</span><span style="color:#d08770;">2
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> d</span><span style="color:#d08770;">1</span><span> is d</span><span style="color:#d08770;">2
</span><span>: </span><span style="color:#96b5b4;">let</span><span> d</span><span style="color:#d08770;">3</span><span> = d</span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> d</span><span style="color:#d08770;">3</span><span> is d</span><span style="color:#d08770;">1
</span></code></pre>
<p>虽然 <code>d1</code> 与 <code>d2</code> 都是空字典，它们按值比较是一样的，但其实是不同的字典实体，用
<code>is</code> 比较显示不一样。为另一个变量 <code>d3</code> 赋值后，就指向相同的字典实体了。</p>
<h3 id="cao-zuo-zi-dian-de-nei-zhi-han-shu">操作字典的内置函数</h3>
<p>上节介绍的许多关于列表的函数，也可作用于字典。只是其他参数意义可能不一样，对于
字典时，一般是根据键来处理的。详情请查阅 <code>:h dict-functions</code>。</p>
<p>但以下几个函数是字典特有的：</p>
<ul>
<li>has_key(dict, key) 检查一个字典是否含有某个键。</li>
<li>keys(dict) 返回由字典的所有键组成的列表。</li>
<li>values(dict) 返回由字典的所有值组成的列表。</li>
<li>items(dict) 返回由字典的所有键值对组成的列表。</li>
</ul>
<p>这几个返回列表的函数一般用于 <code>for ... in</code> 循环中。字典的内部存储是无序的，但可
用 <code>for ... in sort(keys(dict))</code> 根据键顺序遍字典。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
