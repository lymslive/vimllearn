<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>4.1 再谈列表与字符串</h1>
    <!-- ## 4.1 再谈列表与字符串 -->
<h3 id="yin-yong-yu-shi-ti">引用与实体</h3>
<p>前文讲到，列表作为一种集合变量，与标量变量（数字或字符串）有着本质的区别。其中
首要理解的就是一个列表变量只是某个列表实体的引用。</p>
<p>直接用示例说话吧，先看数字变量与字符串变量的平凡例子：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> x = </span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">let</span><span> y = x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;x:&#39;</span><span> x </span><span style="color:#a3be8c;">&#39;y:&#39;</span><span> y
</span><span>: </span><span style="color:#96b5b4;">let</span><span> y = </span><span style="color:#d08770;">2
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;x:&#39;</span><span> x </span><span style="color:#a3be8c;">&#39;y:&#39;</span><span> y
</span><span>:
</span><span>: </span><span style="color:#96b5b4;">let a</span><span> = </span><span style="color:#a3be8c;">&#39;aa&#39;
</span><span>: </span><span style="color:#96b5b4;">let</span><span> b = </span><span style="color:#96b5b4;">a
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;a:&#39; </span><span style="color:#96b5b4;">a </span><span style="color:#a3be8c;">&#39;b:&#39;</span><span> b
</span><span>: </span><span style="color:#96b5b4;">let</span><span> b = </span><span style="color:#a3be8c;">&#39;bb&#39;
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;a:&#39; </span><span style="color:#96b5b4;">a </span><span style="color:#a3be8c;">&#39;b:&#39;</span><span> b
</span></code></pre>
<p>我们先创建了一个数字变量 <code>x</code>，并为其赋值为 <code>1</code>，然后再创建一个变量 <code>y</code>，并为
<code>x</code> 的值赋给它。显然，现在 <code>x</code> 与 <code>y</code> 的值都为 <code>1</code>。随后我们改变 <code>y</code> 的值，重
赋为 <code>2</code>，再查看两个变量的值，发现只有变量 <code>y</code> 的值改变了，<code>x</code> 的值是没改变的
。因此，即使在创建 <code>y</code> 变量时用 <code>:let y = x</code> 看似将它与 <code>x</code> 关联了，但这两个变
量终究是两个独立不同的变量，唯一有关联的也不外是 <code>y</code> 初始化时获取了 <code>x</code> 的值。
此后这两个变量分道扬镳，可分别独立地改变运作。对于字符串变量 <code>a</code> 与 <code>b</code>，也是
这个过程。</p>
<p>然后再看看列表变量：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> aList = [</span><span style="color:#a3be8c;">&#39;a&#39;</span><span>, </span><span style="color:#a3be8c;">&#39;aa&#39;</span><span>, </span><span style="color:#a3be8c;">&#39;aaa&#39;</span><span>]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> bList = aList
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;aList:&#39;</span><span> aList </span><span style="color:#a3be8c;">&#39;bList:&#39;</span><span> bList
</span><span>: </span><span style="color:#96b5b4;">let</span><span> bList = [</span><span style="color:#a3be8c;">&#39;b&#39;</span><span>, </span><span style="color:#a3be8c;">&#39;bb&#39;</span><span>, </span><span style="color:#a3be8c;">&#39;bbb&#39;</span><span>]
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;aList:&#39;</span><span> aList </span><span style="color:#a3be8c;">&#39;bList:&#39;</span><span> bList
</span></code></pre>
<p>结果似乎与上面的数字或字符中标题很相似，没什么差别嘛。虽然 <code>bList</code> 一开始与
<code>aList</code> 表示同一个变量，但后来给 <code>bList</code> 重新定义了一个列表，也没有改变原来的
<code>aList</code> 列表。这与字符串 <code>a</code> <code>b</code> 的关系很一致呢。</p>
<p>但是，我们重新看下面这个例子：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: unlet! aList bList
</span><span>: </span><span style="color:#96b5b4;">let</span><span> aList = [</span><span style="color:#a3be8c;">&#39;a&#39;</span><span>, </span><span style="color:#a3be8c;">&#39;aa&#39;</span><span>, </span><span style="color:#a3be8c;">&#39;aaa&#39;</span><span>]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> bList = aList
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;aList:&#39;</span><span> aList </span><span style="color:#a3be8c;">&#39;bList:&#39;</span><span> bList
</span><span>: </span><span style="color:#96b5b4;">let</span><span> bList[</span><span style="color:#d08770;">0</span><span>] = </span><span style="color:#a3be8c;">&#39;b&#39;
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;aList:&#39;</span><span> aList </span><span style="color:#a3be8c;">&#39;bList:&#39;</span><span> bList
</span></code></pre>
<p>这里先把原来的 <code>aList</code> <code>bList</code> 变量删除了，以免上例的影响。仍然创建了列量变量
<code>aList</code>，与 <code>bList</code> 并让它们“相等”。然后我们通过 <code>bList</code> 变量将列表的第一项
<code>[0]</code> 改成另一个值 <code>b</code>，再查看两个列表的值。这时发现 <code>aList</code> 列表也改变了，与
<code>bList</code> 作出了同样的改变，两者仍是“相等”。</p>
<p>通过这组试验，想说明的是，当 VimL 创建一个列表（变量）时，它其实是在内部维护了
一个列表实体，然后这个变量只是这个列表实体的引用。命令 <code>:let aList = ['a', 'aa', 'aaa']</code>
相当于分以下两步执行工作：</p>
<ol>
<li>new 列表实体 = ['a', 'aa', 'aaa']</li>
<li>let aList = 列表实体的引用</li>
</ol>
<p>然后命令 <code>:let bList = aList</code>，它只是将 <code>aList</code> 变量对其列表实体的引用再赋值给
变量 <code>bList</code>，结果就是，这两个变量都引用了同一个列表实体，或说指向了同一个列表
实体。而命令 <code>:let bList[0] = 'b'</code> 则表示通过变量 <code>bList</code> 修改了它所引用的列表
的第一个元素。但变量 <code>aList</code> 也引用这个列表实体，所以再次查看 <code>aList</code> 时，发现
它的第一个元素也变成 <code>'b'</code> 了。实际上，不管是对 <code>aList</code> 还是 <code>bList</code> 进行索引
操作，都是对同一个它们所引用的那个列表实体进行操作，那是无差别的。</p>
<p>对于普通标量变量，则是另一种情况。当执行命令 <code>:let b = a</code> 时，变量 <code>b</code> 就已经
与 <code>a</code> 是无关的两个独立变量，它只是将 <code>a</code> 的值取出来并赋给 <code>b</code> 而已。但 
<code>:let bList = aList</code> 是将它们指向同一个列表实体，在用户使用层面上，可以认为它
们是同一个东西。但是当执行 <code>:let bList = ['b', 'bb', 'bbb']</code> 后，变量 <code>bList</code>
就指向另一个列表实体了，它与 <code>aList</code> 就再无联系了。</p>
<p>可见，当对列表变量 <code>bList</code> 进行整体赋值时，就改变了该变量所代表的意义。这时与
对字符串变量 <code>b</code> 整体赋值是一样的意义。然而，标量始终只能当作一个完整独立的值
使用，它再无内部结构。例如，无法使用 <code>let b[0] = 'c'</code> 来改变字符串的第一个字符
，只能将另一个字符串整体赋给 <code>b</code> 而达到改变 <code>b</code> 的目的。</p>
<p>总结，只要牢记以下两条准则：</p>
<ul>
<li>标量变量保存的是值；</li>
<li>列表变量保存的是引用。</li>
</ul>
<h3 id="han-shu-can-shu-yu-yin-yong">函数参数与引用</h3>
<p>我们再通过函数调用参数来进一步说明列表的引用特性。</p>
<p>举个简单的例子，交换两个值，可以引入一个临时变量，由三条语句完成：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> tmp = </span><span style="color:#96b5b4;">a
</span><span>: </span><span style="color:#96b5b4;">let a</span><span> = b
</span><span>: </span><span style="color:#96b5b4;">let</span><span> b = tmp
</span></code></pre>
<p>这种交换值的需求挺常见的，考虑包装成一个函数如何？</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">Swap</span><span>(iValue, jValue) abort
</span><span>:     </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:tmp</span><span> = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>iValue
</span><span>:     </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>iValue = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>jValue
</span><span>:     </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>jValue = </span><span style="color:#bf616a;">l:tmp
</span><span>: </span><span style="color:#b48ead;">endfunction
</span></code></pre>
<p>但是，当尝试调用 <code>:call Swap(a, b)</code> 时，vim 报错了。因为参数作用域 <code>a:</code> 是只读
变量，所以不能给 <code>a:iValue</code> 或 <code>a:jValue</code> 赋另外的值。但是，即使参数不是只读的
，这样的交换函数也是没效果的（比如用 C 或 python 改写这个交换函数）。因为在调
用 <code>Swap(a, b)</code> 时，相当于先执行以下两个赋值语句给参数赋值：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>iValue = </span><span style="color:#96b5b4;">a
</span><span>: </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>jValue = b
</span></code></pre>
<p>此外，不管在函数内不管怎么倒腾参数 <code>a:iValue</code> 与 <code>b:jValue</code>，都不会影响原来的
<code>a</code> 与 <code>b</code> 变量。因为如前所述，标量赋值，只是拷贝了值，等号两边的变量是再无联
系的。</p>
<p>但是，交换列表不同位置上的元素是可实现的，比如把上面那个交换函数改成三参数版，
第一个参数是列表，跟着两个索引：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">Swap</span><span>(list, idx, jdx) abort
</span><span>:     </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:tmp</span><span> = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list[</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>idx]
</span><span>:     </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>list[</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>idx] = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list[</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>jdx]
</span><span>:     </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>list[</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>jdx] = </span><span style="color:#bf616a;">l:tmp
</span><span>: </span><span style="color:#b48ead;">endfunction
</span></code></pre>
<p>请试运行以下语句确认这个函数的有效性：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo</span><span> aList
</span><span>: call </span><span style="color:#8fa1b3;">Swap</span><span>(aList, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">1</span><span>)
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> aList
</span></code></pre>
<p>在写较复杂的 VimL 函数时，一般不建议在函数体内大量使用 <code>a:</code> 作用域参数。因为传
入的参数是无类型的，很可能是不安全的。最好在函数的开始作一些检查，合法后再将
<code>a:</code> 参数赋给一个 <code>l:</code> 变量，然后在函数主体中只对该局部变量操作。此后，如果入参
的需求有变动，就只修改函数前面几行就可以了。例如再将交换函数改成如下
版本：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">Swap</span><span>(list, idx, jdx) abort
</span><span>:     </span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">type</span><span>(</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list) </span><span style="color:#b48ead;">== </span><span style="color:#bf616a;">v:t_list </span><span style="color:#b48ead;">|| </span><span style="color:#8fa1b3;">type</span><span>(</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list) </span><span style="color:#b48ead;">== </span><span style="color:#bf616a;">v:t_dict
</span><span>:         </span><span style="color:#96b5b4;">let</span><span> list = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list
</span><span>:     </span><span style="color:#b48ead;">else
</span><span>:         </span><span style="color:#b48ead;">return </span><span style="color:#65737e;">&quot; 只允许第一参数为列表或字典
</span><span>:     </span><span style="color:#b48ead;">endif
</span><span>:
</span><span>:     </span><span style="color:#96b5b4;">let</span><span> i = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>idx + </span><span style="color:#d08770;">0 </span><span style="color:#65737e;">&quot; 显式转为数字
</span><span>:     </span><span style="color:#96b5b4;">let</span><span> j = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>jdx + </span><span style="color:#d08770;">0
</span><span>:
</span><span>:     </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:tmp</span><span> = list[i]
</span><span>:     </span><span style="color:#96b5b4;">let</span><span> list[i] = list[j]
</span><span>:     </span><span style="color:#96b5b4;">let</span><span> list[j] = </span><span style="color:#bf616a;">l:tmp
</span><span>: </span><span style="color:#b48ead;">endfunction
</span></code></pre>
<p>再用以下语句来测试修改版的交换函数：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: call </span><span style="color:#8fa1b3;">Swap</span><span>(aList, </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>)
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> aList
</span></code></pre>
<p>可见，即使在函数体内，将参数 <code>a:list</code> 赋给另一个局部变量 <code>l:list</code>，交换工作也
正常运行。因为 <code>g:aList</code> <code>a:list</code> 与 <code>l:list</code> 其实都是同一个列表实体的引用啊。</p>
<h3 id="lie-biao-jie-bao">列表解包</h3>
<p>在 3.4 节我们用 <code>execute</code> 定义了一个 <code>:LET</code> 命令，用于实现连等号赋值。但实际上
可以直接用列表赋值的办法实现类似的效果。例如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: LET x=y=z=</span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">let</span><span> [x, y, z] = [</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">1</span><span>]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> [x, y, z] = [</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>]
</span></code></pre>
<p>其中前两个语句的结果完全一样，都是为 <code>x</code> <code>y</code> <code>z</code> 三个变量赋值为 <code>1</code>。注意等号
左边也需要用中括号把待赋值变量括起来，分别用等号右侧的列表元素赋值。这种行为就
叫做列表解包（List unpack），即相当于把列表元素提取出来放在独立的变量中。显然
用这种方法为多个变量赋值更具灵活性，可以为不同变量赋不同的值。</p>
<p>这个语法除了可多重赋值外，还能方便地实现变量交换，如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> [x, y] = [y, x]
</span></code></pre>
<p>用过 python 的对此用途应该很有亲切感。不过在 VimL 中，等号两边的中括号不可省略
，且等号两边的列表元素个数必需相同，否则会出错。不过在左值列表中可以用分号分隔
最后一个变量，用于接收右值列表的剩余元素，如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> [v</span><span style="color:#d08770;">1</span><span>, v</span><span style="color:#d08770;">2</span><span>; rest] = list
</span><span style="color:#65737e;">&quot; 相当于
</span><span>: </span><span style="color:#96b5b4;">let</span><span> v</span><span style="color:#d08770;">1</span><span> = list[</span><span style="color:#d08770;">0</span><span>]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> v</span><span style="color:#d08770;">2</span><span> = list[</span><span style="color:#d08770;">1</span><span>]
</span><span>: </span><span style="color:#96b5b4;">let</span><span> rest = list[</span><span style="color:#d08770;">2</span><span>:]
</span></code></pre>
<p>在上例中假设 <code>list</code> 列表元素只包含简单标量，则解包赋值后，<code>v1</code> <code>v2</code> 都是只接收
了一个元素值的标量，而 <code>rest</code> 则接收了剩余元素，它还是个（稍短的）列表变量。而
<code>list[2:]</code> 的语法是列表切片（slice）。</p>
<h3 id="suo-yin-yu-qie-pian">索引与切片</h3>
<p>这里再归纳一下列表的索引用法：</p>
<ul>
<li>索引从 0 开始，不是从 1 开始。</li>
<li>可以使用负索引，-1 表示最后一个索引。</li>
<li>可以使用多个索引，这也叫切片，表示列表的一部分。</li>
</ul>
<p>要索引一个列表元素时，用正索引或负索引等效的，这取决于应用场合用哪个方便。如果
列表长度是 <code>n</code>，则以下表示法等效：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>list[n</span><span style="color:#d08770;">-1</span><span>] </span><span style="color:#b48ead;">==</span><span> list[</span><span style="color:#d08770;">-1</span><span>]
</span><span>list[</span><span style="color:#d08770;">0</span><span>]   </span><span style="color:#b48ead;">==</span><span> list[-n]
</span><span>list[i]   </span><span style="color:#b48ead;">==</span><span> list[i-n]
</span></code></pre>
<p>然而，不管正索引，还是负索引，都不能超出列表索引（长度）范围。</p>
<p>列表切片（slice）是指用两个索引提取一段子列表。<code>list[i:j]</code> 表示从索引 <code>i</code> 到索
引 <code>j</code> 之间（包含两端）的元素组成的子列表。注意以下几点：</p>
<ul>
<li><code>i</code> <code>j</code> 同样支持负索引，不管用正负索引，如果 <code>i</code> 索引在 <code>j</code> 索引之后，则切片
结果是空列表。</li>
<li>如果 <code>i</code> 超出了列表左端（<code>0</code> 或 <code>-n</code>），或 <code>j</code> 超出列表右端，结果也是空列表
。</li>
<li>可省略起始索引 <code>i</code>，则默认起始索引为 <code>0</code>；省略结束索引 <code>j</code>，则默认是最后一个索
引 <code>-1</code>；如果都省略，只剩一个冒号，<code>list[:]</code> 与原列表 <code>list</code> 是一样的（但是
另一个拷贝列表）。</li>
<li>可以为切片赋值，即将一个列表的切片放在等号左边作为左值，可改变索引范围内的元
素值，但一般右值要求是与切片具有相同项数的列表。</li>
<li>不支持三索引表示步长，<code>list[i:j:step]</code> 或 <code>list[i:j:step]</code> 在 VimL 中是非法
的，不支持跳格切片，只支持连续切片。</li>
<li><code>list[s:e]</code> 表示法有歧义，因为可能存在脚本局部变量 <code>s:e</code>，则用该变量值单索引
列表。可在冒号前后加空格避免歧义，<code>list[s : e]</code> 表示切片。</li>
</ul>
<h3 id="chu-li-lie-biao-de-nei-zhi-han-shu">处理列表的内置函数</h3>
<p>VimL 提供了一些基本的内置函数用于列表的常用操作，详细用法请参考文档
<code>:help list-functions</code>，这里仅归纳概要。</p>
<ul>
<li>
<p>查询列表信息的函数：</p>
<ul>
<li>len(list) 取列表长度，列表的最大索引是 len(list)-1。</li>
<li>empty(list) 判断列表是否为空，即列表长度为 0。</li>
<li>get(list, i) 相当于 list[i]，但是当 i 超出索引范围时，get() 函数不会出错，且
可再提供第三参数表示超出索引时的默认值（如果省略，默认值0）。</li>
<li>index(list, item) 查找一个元素在列表中的位置，如果不存在该元素，则返回 -1。</li>
<li>count(list, item) 检查一个元素在列表中出现多少次。</li>
<li>max(list) min(list) 查询一个列表中的最大或最小元素。</li>
<li>string(list) 将列表转化为字符串表示法。</li>
<li>join(list, sep) 将列表中的元素用指定分隔符连接为一个字符串表示。</li>
</ul>
</li>
<li>
<p>修改列表元素的函数：</p>
<ul>
<li>add(list, item) 在列表末尾添加一个元素。</li>
<li>insert(list, item) 在列表头部添加一个元素，比 add() 尾添加低效。但 insert()
可额外提供第三参数表示要插入的索引位置，省略即 0 表示插在最前面。</li>
<li>remove(list, idx) 删除位置 idx 上的一个元素，remove(list, i, j) 删除从 i 到
j 索引之间的所有无素，相当于 unlet list[i:j]。</li>
</ul>
</li>
<li>
<p>生成列表的函数：</p>
<ul>
<li>range() 支持一至三个参数，生成连续或定步长的数字列表。</li>
<li>extend(list1, list2) 连接两个列表，相当于 list1+list2，但 extend 会原位修改
list1 列表。与 add() 函数不同的是，add 只增加一个元素，而 extend 是加入另一
个列表。</li>
<li>repeat(list, count) 相当于不断连接自身，总计重复 count 次，生成一个更长的列
表。</li>
<li>copy(list)，生成一个列表副本，用等号赋值只是引用同一个列表实体，用 copy() 函
数才能生成另一个新列表（每个元素值与原列表相同而已）。copy() 函数是浅拷贝，
列表元素直接赋值。如果要考虑列表元素也可能是列表或字典（引用），则用
deepcopy(list) 递归拷贝完全的副本。</li>
<li>reverse(list) 将一个列表倒序排列，原位修改原列表。</li>
<li>split(list, pattern)，将一个字符串分解为列表，相当于 join() 的反函数。</li>
</ul>
</li>
<li>
<p>分析列表的高阶函数：</p>
<ul>
<li>sort(list) 为一个列表排序。</li>
<li>uniq(list) 删除列表中相邻的重复元素，列表需已排序。</li>
<li>map(list, expr) 将列表每个元素进行某种运算，将结果替换原元素。</li>
<li>filter(list, expr) 将列表每个元素进行某种运算，若结果为 0，则删除相应元素。</li>
</ul>
</li>
</ul>
<p>这些高阶函数，除了都会原位修改作为第一个参数的列表外，都还能接收额外参数表明如
何处理每个元素。由于额外参数可以是另一个函数（引用），所以称之为高阶函数。其具
体用法略复杂，在后面相关章节将继续讲解部分示例。</p>
<h3 id="zi-fu-chuan-yu-lie-biao-de-guan-xi">字符串与列表的关系</h3>
<p>字符串在很大程序上可以理解为字符列表，可以用类似的索引与切片机制。但是，字符串
与列表的最大区别在于，字符串是一个完整的不可变标量。所以，凡是可以改变列表内部
某个元素的操作（如索引赋值、切片赋值）或函数（如 add/remove 等），都不可作用于
字符串。而 copy() 也没必要用于字符串，直接用等号赋值即可。不过 repeat() 函数作
用于字符串很有用，能方便生成长字符串。</p>
<p>将字符串打散为字符数组，可用如下函数方法：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> string = </span><span style="color:#a3be8c;">&#39;abcdefg&#39;
</span><span>: </span><span style="color:#96b5b4;">let</span><span> list = </span><span style="color:#8fa1b3;">split</span><span>(string, </span><span style="color:#a3be8c;">&#39;\zs&#39;</span><span>)
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> list
</span></code></pre>
<p>split(string, pattern) 函数是将字符串按某种模式分隔成列表的。<code>\zs</code> 不过是一种
特殊模式，它可以匹配任意字符之间（详情请参考正则表达式文档），所以结果就是将每
个字符分隔到列表中了。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
