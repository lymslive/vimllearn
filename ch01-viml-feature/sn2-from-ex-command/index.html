<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>1.2 同源 ex 命令行</h1>
    <!-- ## 1.2 同源 ex 命令行 -->
<p>那么，VimL 到底是种什么样的语言。这里先说结论吧，VimL 就是富有程序流程控制的
<code>ex</code> 命令。用个式子来表示就是：</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>VimL = ex 命令 + 流程控制
</span></code></pre>
<p>VimL 源于 ex ，基于 ex，即使它后来加了很多功能，也始终兼容 ex 命令。</p>
<p>然则什么是 ex 命令，这不好准确定义，形象地说，就是可以在 Vim 底部命令行输入并
执行的语句。什么是流程控制，这也不好定义呢，类比地说，就是像其他大多语言支持的
选择、循环分支，还有函数，因为函数调用也是种流程跳转。</p>
<p>下面，还是用些例子来阐述。</p>
<h3 id="di-yi-ge-jiao-ben-vimrc">第一个脚本：vimrc</h3>
<p>为了说明 <code>vimrc</code> 先假设你没有 <code>vimrc</code> 。这可以通过以下参数启动 vim：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cd </span><span style="color:#bf616a;">~</span><span>/.vim/vimllearn/
</span><span style="color:#bf616a;">$</span><span> vim</span><span style="color:#bf616a;"> -u</span><span> NONE
</span></code></pre>
<p>这样启动的 vim 不会加载任何配置文件，可以假装自己是个只会用裸装 vim 的萌新。同
时也保证以下示例中所遇命令没有被重映射，始终能产生相同的结果。</p>
<p>Vim 主要功能是要用来编辑一些东西的，所以我们需要一些语料文本。这也可以用 vim
的普通命令生成，请在普通模式下依次输入以下按键（命令）：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#d08770;">20</span><span>aHello World!&lt;ESC&gt;
</span><span>yy
</span><span style="color:#d08770;">99</span><span>p
</span><span>: w helloworld</span><span style="color:#b48ead;">.</span><span>txt&lt;CR&gt;
</span></code></pre>
<p>其中输入的按键不包括换行符，上面分几行显示，只为方便分清楚几个步骤的命令。</p>
<p>首先是个 <code>a</code> 命令，进入插入模式，输入字符串“Hello World!”，然后按 <code>&lt;ESC&gt;</code> 键
返回普通模式（这里<code>&lt;ESC&gt;</code>表示那个众所周知的特殊键，不是五个字符啦）。<code>a</code> 之前
的 <code>20</code> 是还在普通模式下输入的数字参数，（它不会显示在光标所在的当前行，而是临时
显示在右下角，然而一般不必关注）这表示后来的命令重复执行多少次。所以结果是在当
前行插入了 20 个 “Hello World!”，也就是新文件的第一行。</p>
<p>接着命令 <code>yy</code> 是复制当前行，<code>99p</code> 是再粘贴 99 行。于是总共得到 100 行 “Hello
World!” ——满屏尽是 Hello World!，应该相当壮观。</p>
<p>最后的命令是用冒号 <code>:</code> 进入 ex 命令行，保存文件，<code>&lt;CR&gt;</code> 表示回车，ex 命令需要
回车确认执行。</p>
<p>现在，我们已经在用 vim 编辑一个名为 <code>helloworld.txt</code> 的文件了。看着有点素是不
是？可以用下面的 ex 命令设置行号选项：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">set</span><span> number
</span></code></pre>
<p>如此就会在文本窗口左则增加几列特殊列，为文件中的每行编号，确认一下是不是恰好
100 行，用 <code>G</code> 普通命令翻到最后一行。</p>
<p>还有，是不是觉得每一行太长了，超过了窗口右边界。（如果你用的是超大显示屏，Vim
的窗口足够大还没超过，那么在一开始的示例中，把数字参数 <code>20</code> 调大吧）如果想让
vim 折行显示，则用如下命令设置选项：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">set</span><span> wrap
</span></code></pre>
<p>可以看到，长行都折行显示了，但是行编号并没有改变。也就是说文件中仍是只有 100
行，只有太长的行，vim 自动分几行显示在屏幕窗口上了。</p>
<p>你可以继续输入些设置命令让 vim 的外观更好看些，或让其操作方式更贴心些。但是等
等，这样通过冒号一行行输入实在是太低效，应该把它保存到一个 vim 脚本文件中。</p>
<p>按冒号进入命令行后，再按 <code>&lt;Ctrl-F&gt;</code> 将打开一个命令行窗口，里面记录着刚才输入的
ex 历史命令。这个命令窗口的设计用意是为了便于重复执行一条历史命令，或在某条历
史命令的基础上小修后再执行。不过现在我们要做的是将刚才输入的两条命令保存到一个
文件中，比如就叫 <code>vimrc.vim</code>，整个按键序列是：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: &lt;Ctrl-F&gt;
</span><span>Vk
</span><span>: </span><span style="color:#a3be8c;">&#39;&lt;, &#39;</span><span>&gt; w vimrc</span><span style="color:#b48ead;">.</span><span>vim&lt;CR&gt;
</span><span>: q&lt;CR&gt;
</span></code></pre>
<p>解释一下：进入命令窗口后光标自动在最后一行，<code>V</code> 表示进入行选择模式，<code>k</code> 上移一
行，即选择了最后两行。在选择模式下按 <code>:</code> 进入命令行，会自动添加 <code>'&lt;, '&gt;</code>，这是
特殊的行地址标记法，表示选区，然后用 <code>:w</code> 命令将这两行写入 <code>vimrc.vim</code> 文件（
注意当前目录应在 <code>~/.vim/vimllearn</code> 中）。最后的 <code>:q</code> 命令只是退出命令窗口，但
vim 仍处于编辑 <code>helloworld.txt</code> 状态中。</p>
<p>你需要再输入一个 <code>:q</code> 退出 vim，然后用刚才保存的脚本当作启动配置文件重新打开文
件，看看效果：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>:q&lt;CR&gt;
</span><span>$ vim -u vimrc</span><span style="color:#b48ead;">.</span><span>vim helloworld</span><span style="color:#b48ead;">.</span><span>txt
</span></code></pre>
<p>可见，重新打开 <code>helloworld.txt</code> 文件后也自动设置了行号与折行。你可以换这个参
数启动 vim 对比下效果，确认是 <code>vimrc.vim</code> 的功效：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> vim</span><span style="color:#bf616a;"> -u</span><span> NONE helloworld.txt
</span></code></pre>
<p>可以手动编辑 <code>vimrc.vim</code> 增加更多配置命令：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: e vimrc</span><span style="color:#b48ead;">.</span><span>vim
</span></code></pre>
<p>这样就切换到编辑 'vimrc.vim' 状态了，里面已经有了两行，用普通命令 <code>Go</code> 在末尾
打开新行进入插入模式，加入如下两行（还可自行添加一些注释）：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">nnoremap</span><span> j gj
</span><span>: </span><span style="color:#96b5b4;">nnoremap</span><span> k gk
</span></code></pre>
<p>按 <code>&lt;ECS&gt;</code> 回普通模式再用 <code>:w</code> 保存文件。可以退出 vim 后重新用
<code>$ vim -u vimrc.vim helloworld.txt</code> 参数启动 vim 打开文件观察效果。也可以在当
前的 vim 环境中重新加载 <code>vimrc.vim</code> 令其生效：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: source </span><span style="color:#b48ead;">%
</span><span>: e #
</span></code></pre>
<p>其中，<code>:e #</code> 或快捷键 <code>&lt;Ctrl-^&gt;</code> 表示切换到最近编辑的另一个文件，这里就是
<code>helloworld.txt</code> 文件啦，在这个文件上移动 <code>j</code> <code>k</code> 键，看看是否有什么不同体验了
。</p>
<p>不过，表演到此为止吧。这段演示示例主要想说明几点：</p>
<ol>
<li>VimL 语言没什么神秘，把一些 ex 命令保存到文件中就是 vim 脚本了。</li>
<li>vimrc 配置文件是 vim 启动时执行的第一个脚本，也应是大多数 Vim 初学者编写的
第一个实用脚本。</li>
</ol>
<p>关于 vim “命令” 这个名词，还有一点要区分。普通模式下的按键也叫“命令”，可称之为
“普通命令”，但由于普通模式是 Vim 的主模式，所以“普通命令”也往往简称为“命令”了
。通过冒号开始输入而用回车结束输入的，叫 &quot;ex 命令&quot;，vim 脚本文件不外是记录
“ex 命令”集。（注：宏大多是记录普通命令）</p>
<h3 id="mo-ren-de-vimrc-wei-zhi">默认的 vimrc 位置</h3>
<p>正常使用 vim 时不会带 <code>-u</code> 启动参数，它会从默认的位置去找配置文件。这可以在
shell 中执行这个命令来查看：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> vim</span><span style="color:#bf616a;"> --version
</span></code></pre>
<p>或者在任一已启动的 vim 中用这个 ex 命令 <code>:version</code> 也是一样的输出。在中间一段
应该有类似这样几行：</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>系统 vimrc 文件: &quot;$VIM/vimrc&quot;
</span><span>用户 vimrc 文件: &quot;$HOME/.vimrc&quot;
</span><span>第二用户 vimrc 文件: &quot;~/.vim/vimrc&quot;
</span><span>用户 exrc 文件: &quot;$HOME/.exrc&quot;
</span><span>defaults file: &quot;$VIMRUNTIME/defaults.vim&quot;
</span></code></pre>
<p>它告诉了我们 vim 搜索 vimrc 的位置与顺序。主要是这两个地方，<code>~/.vimrc</code>，
<code>~/.vim/vimrc</code>。用户可用其中一个做为自定义配置，强烈建议用第二个 <code>~/.vim/vimrc</code>。
因为配置可能渐渐变得很复杂，将所有配置放在一个目录下管理会更方便。不过有些低版
本的 vim 可能不支持 <code>~/.vim/vimrc</code> 配置文件，在 unix/linux 系统下可将其软链接
为 <code>~/.vimrc</code> 即可。</p>
<p>需要注意的是，<code>vimrc</code> 是个特殊的脚本，习惯上没有 <code>.vim</code> 后缀。</p>
<p>如何配置 vimrc 属于使用 Vim 的知识（或经验）范畴，不是本 VimL 教程的重点。不过
为了说明 VimL 的特点，也给出一个简单的示例框架如下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#65737e;">&quot; File: ~/.vim/vimrc
</span><span>
</span><span style="color:#96b5b4;">let</span><span> $VIMHOME = $HOME </span><span style="color:#b48ead;">. </span><span style="color:#a3be8c;">&#39;/.vim&#39;
</span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">has</span><span>(</span><span style="color:#a3be8c;">&#39;win32&#39;</span><span>) </span><span style="color:#b48ead;">||</span><span> has (</span><span style="color:#a3be8c;">&#39;win64&#39;</span><span>)
</span><span>    </span><span style="color:#96b5b4;">let</span><span> $VIMHOME = $VIM </span><span style="color:#b48ead;">. </span><span style="color:#a3be8c;">&#39;/vimfiles&#39;
</span><span style="color:#b48ead;">endif
</span><span>
</span><span>source $VIMHOME/setting</span><span style="color:#b48ead;">.</span><span>vim
</span><span>source $VIMHOME/</span><span style="color:#96b5b4;">remap</span><span style="color:#b48ead;">.</span><span>vim
</span><span>source $VIMHOME/plug</span><span style="color:#b48ead;">.</span><span>vim
</span><span>
</span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">has</span><span>(</span><span style="color:#a3be8c;">&#39;gui&#39;</span><span>)
</span><span style="color:#65737e;">    &quot; source ...
</span><span style="color:#b48ead;">endif
</span><span>
</span><span>finish
</span><span style="color:#96b5b4;">let</span><span> $USER = </span><span style="color:#a3be8c;">&#39;vimer&#39;
</span><span style="color:#96b5b4;">echo </span><span style="color:#a3be8c;">&#39;Hello &#39; </span><span style="color:#b48ead;">.</span><span> $USER </span><span style="color:#a3be8c;">&#39;! Working on: &#39; </span><span style="color:#b48ead;">. </span><span style="color:#8fa1b3;">strftime</span><span>(</span><span style="color:#a3be8c;">&quot;%Y-%m-%d %T&quot;</span><span>)
</span></code></pre>
<p>一般地，一份 vimrc 配置包括选项设置，快捷键映射，插件加载等几部分，每部分都可
能变得复杂起来，为方便管理，可以分别写在不同的 vim 脚本中，然后在主 vimrc 脚本
中用 <code>:source</code> 命令调用。这就涉及脚本路径全名问题了，若期望能跨平台，就可创建
一个变量，根据运行平台设置不同路径，这就用到了 <code>:if</code> 分支命令了。</p>
<p>最后两行打印个欢迎词。你可以将自己的大名赋给变量 <code>$USER</code>。如果，你觉得这很傻很
天真，可以移到 finish 之后就不生效了。</p>
<p>在 vimrc 中，选择分支可能很常见，根据不同环境加载合适的配置嘛。但循环就很少见
了。因为 vim 向来还有个追求是小巧，启动快，那么你在启动脚本中写个循环是几个意
思啊，万一写个死循环BUG还启不起来了。</p>
<h3 id="liu-cheng-kong-zhi-yu-ju-ye-shi-ex-ming-ling">流程控制语句也是 ex 命令</h3>
<p>在 VimL 中，每一行都是 <code>ex 命令</code>。作为一门脚本语言，最常见的，创建变量要用
<code>:let</code> 命令，调用函数要用 <code>:call</code> 命令。初学者最易犯与迷惑的错误，就是忘了
<code>let</code> 或 'call'，裸用变量，裸调函数，比如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>i = </span><span style="color:#d08770;">-1
</span><span style="color:#8fa1b3;">abs</span><span>(</span><span style="color:#d08770;">-1</span><span>)
</span></code></pre>
<p>用过其他语言的可能会觉得这很自然，但在 VimL 中是个错误，因为它要求第一个词是钦
定的 <code>ex 命令</code>！正确的写法是：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">let</span><span> i = </span><span style="color:#d08770;">-1
</span><span>call </span><span style="color:#8fa1b3;">abs</span><span>(</span><span style="color:#d08770;">-1</span><span>)
</span></code></pre>
<p>从这个意义上讲，VimL 与 shell 脚本很类似的，把命令行语句保存到文件中就成了脚本
。每一行都以可执行命令开始，后面的都算作该命令的参数。</p>
<p>在 VimL 中，<code>:if</code> <code>:for</code> <code>:while</code> 也当作扩展的 <code>ex 命令</code> 处理，在 vim 脚本中，
这些“关键词”前面，可以像 <code>:set</code> 一样加个可选的冒号。同时，也可以像其他 ex 命令
一样在无歧义时任意简写。比如：</p>
<ul>
<li><code>:endif</code> 可简写为 <code>en</code> 或 <code>end</code> 或 <code>endi</code> 或 <code>endif</code></li>
<li><code>:endfor</code> 可简写为 <code>endfo</code></li>
<li><code>:endfunction</code> 可简写为 <code>endf</code>，后面补上 <code>unction</code> 任意前几个字符也可以。</li>
</ul>
<p>这套缩写规则，就与替换命令 <code>:substitute</code> 简写为 <code>:s</code>，设置命令 <code>:set</code> 简写为
<code>:se</code> 一样一样的。但是，在写脚本时，强烈建议都写命令全称。命令简写只为在命令行
中快速输入，而在脚本中只要输入一次，一劳永逸，就应以可读性为重了。</p>
<p>当有了这个意识，VimL 的一些奇怪语法约定，也就显得容易理解多了。比如：</p>
<ul>
<li>ex 命令以回车结束，所以 VimL 语句也按行结束，不要在末尾加分号，加了反而是语
法错误，在 Vim 中每个符号都往往有奇葩意义。</li>
<li>VimL 的续行符 <code>\</code> 写在下一行的开始，其他一些语言是把 <code>\</code> 写在上一行结束，表
示转义掉换行符，合为一行。但在 VimL 中，每一行都需要一个命令，你可以把 <code>\</code>
想象为一个特殊命令，意思是“合并到上一行”。</li>
<li>在 VimL 中，不推荐在一行写多个语句，要写也可以，把反斜杠 <code>\</code> 扶正为竖线 <code>|</code>
表示语句分隔吧。这在 vim 下临时手输单行命令时可能较为常见，减少额外按回车与
冒号。在很多键盘布局中，<code>|</code>（与<code>\</code>）恰好在回车键上面。</li>
</ul>
<h3 id="guan-jian-ming-ling-lie-biao">关键命令列表</h3>
<p>Vim 的 <code>ex 命令</code>集是个很大的集合，比绝大多数的语言的关键字都多一个数量级。幸运
的是，我们写 VimL 语言的脚本，并不需要掌握或记住这所有的命令，只要记住一些主要
的关键命令就可以完成大部分需求了。</p>
<p>我从 VimL 语言的角度，按常用度与重要度并结合功能性将那些主要的命令分类如下，
仅供参考：</p>
<ol>
<li>let call (unlet)</li>
<li>if for while function try (endif, endfor, end...)</li>
<li>break continue return finish</li>
<li>echo echomsg echoerr</li>
<li>execute normal source</li>
<li>set map command </li>
<li>augroup autocmd</li>
<li>wincmd tabnext</li>
<li>其他着重于编辑功能的命令</li>
</ol>
<p>其中，第 5 类恰好是个分界线，之上的是形成 VimL 语言的关键命令，之下是作为 Vim
编辑器的重要命令。没有后面的编辑器命令，纯 VimL 语言也可以写脚本，作为一种（没
有什么优势的）通用脚本而已；只有利用后面的编辑器命令，才可以调控 Vim。</p>
<p>后面的编辑器命令也可以单独使用，所以 Vim 高手也未必一定需要会 VimL。不过有了
VimL 语言命令的助力，那些编辑器命令可变得更高效与灵活。不过最后一大类纯编辑命
令，可能较少出现在 VimL 语言脚本中。因为按 Vim 可视化编辑的理念，是需要使用者
对这些编辑结果作出及时反馈的。同时，很多编辑命令也有相应的函数，在 VimL 中调用
函数，可能更显得像脚本语言。所以，VimL 中不仅有“库函数”的概念，还有“库命令”呢
。</p>
<p>总之，语句与命令，是联结 VimL 与 Vim 的重要纽带。这是 VimL 语言的重要特点，也
是初学者的一大疑难点。尤其是对有其他语言编程经验的，可能还需要一定的思维转换过
程吧。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch01-viml-feature/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
