<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>1.3 弱类型强作用域</h1>
    <!-- ## 1.3 弱类型强作用域 -->
<p>“弱类型”不是 VimL 的特点，是几乎所有脚本语言的特点。准确地说是变量无类型，但值
有类型。创建变量时不必定义类型，直接赋值就行，也可以认为是变量临时获得了值的类
型。关于 VimL 的变量与类型，将在下一章的基础语法中详解。</p>
<p>变量作用域是编程的另一个重要概念，也几乎每个语言都要管理的任务。这里说 VimL 具
有“强作用域”的特点，是指它提供了一种简明的语法，让用户强调变量的作用域范围。</p>
<h3 id="viml-yu-yan-ji-de-zuo-yong-yu-g-l-s-a">VimL 语言级的作用域 g: l: s: a:</h3>
<p>变量作用域的意义是指该变量在什么范围内可见，可被操作（读值或赋值）。在 VimL 中
，每个变量都可以加上一个冒号前缀，表示该变量的作用域。不过另有两条规则：</p>
<ol>
<li>在一些上下文环境中，可以省略作用域前缀，等效于加上了默认的作用域前缀</li>
<li>有一些作用域前缀只在特定的上下文环境中使用。</li>
</ol>
<p>从 VimL 语言角色看，主要有以下几种作用域：</p>
<ol>
<li><code>g:</code> 全局作用域。全局变量就是在当前 vim 会话环境中，在任何脚本，任何 ex 命
令行中都可以引用的变量。所有在函数之外的命令语句，都默认是全局变量。</li>
<li><code>l:</code> 局部作用域。只可在当前执行的函数体内使用的变量，在函数体内的变量默认为
局部变量，<code>l:</code>局部变量也只能在函数体内使用。</li>
<li><code>s:</code> 脚本作用域。只有当前脚本内可引用的变量，包括该脚本的函数体内。</li>
<li><code>a:</code> 参数作用域。特指函数的参数，在函数体内，要引用传入的实参，就得加上
<code>a:</code> 前缀，但定义函数时的形参，不能加 <code>a:</code> 前缀。<code>a:</code> 还隐含一个限定是只读
性，即不能在函数体内修改参数。</li>
</ol>
<p>这几种作用域前缀所对应的英文单词，可认为是 <code>global</code>, <code>local</code>, <code>script</code> 与
<code>argument</code>。不过 <code>s:</code> 也可认为是 <code>static</code>，因为在 C 语言中，<code>static</code> 也表示只
在当前文件中有效的意思。</p>
<p>变量作用域的应用原则：</p>
<ol>
<li>尽量少用全局变量，因为容易混乱使用，难于管理。不过在 ex 命令行或 Ex 模式下
只为临时测试的语句，为了方便省略前缀，是全局变量，当然在此命令中也只能是全
局变量。在写 vim 脚本文件时，若要使用全局变量，不要省略 <code>g:</code> 前缀。同时全局
变量名尽量取得特殊点，比如全是大写，或带个插件名的长变量名，以减少被冲突的
概率。</li>
<li>局部变量的前缀 <code>l:</code> 一般可省略。但我建议也始终加上，虽然多敲了两个字符，但
编程的效率来源于思路清晰，不在于少那几个字符。同时在 VimL 编程时，坚持习
惯了作用域前缀，就能在头脑中无形地加强这种意识，然后对作用域的把握也更加精
准。另外，显然地，在函数体内要引用全局就是必须加上 <code>g:</code> 前缀。</li>
<li>在写 vim 脚本时，函数外的代码，能用 <code>s:</code> 变量就尽量用 <code>s:</code> 变量。对于比较大
的脚本变量（如字典），想对外分享，也宁可先定义为 <code>s:</code> 变量，再定义一个全局
可访问的函数来返回这个脚本变量。</li>
<li>参数变量，<code>a:</code>是语法强制要求，漏写了 <code>a:</code> 往往是个错误，（如果它没报错，恰
好与同名局部变量冲突了，那是更糟糕与难以觉察的错误）也是初写 VimL 函数最容
易犯的语法错误。</li>
</ol>
<h3 id="vim-shi-ti-zuo-yong-yu-b-w-t">Vim 实体作用域 b: w: t:</h3>
<p>Vim 作为一个可视化的编辑器，给用户呈现的，能让用户交互地操作的实体对象主要有
<code>buffer</code>（缓冲文件），<code>window</code>（窗口），<code>tabpage</code>（标签页）。可以把它们想象为
互有关系的容器：</p>
<ul>
<li>缓冲对应着一个正在编辑中的文件，在不细究的情况下可认为与文件等同。（不过不一
定对应着硬盘上的一个文件，比如新建的尚未保存的文件，以及一些特殊缓冲文件）缓
冲也可认为是容纳着文件中所有文本行的容器，就像是简单的字符串列表了。</li>
<li>窗口是用于展示缓冲文件的一部分在屏幕上的容器。Vim 可编辑的文件很大，极有可能
在一个屏幕窗口中无法显示文件的所有内容，所以窗口对应于缓冲文件还有个可视范
围。一个窗口在一个时刻只能容纳一个缓冲文件，但在不同时刻可以对应不同的缓冲文
件。</li>
<li>标签页是可以同时容纳不同的窗口的另一层更大的容器。原始的 <code>Vi</code> 没有标签页，标
签页是 <code>Vim</code> 的扩展功能。标签页极大增强 <code>Vim</code> 的可视范围，可认为窗口是平面的
，再叠上标签页就是（伪）立体的了。</li>
<li>一个缓冲文件可以展示在不同的窗口或（与）标签页中。所有已展示在某个窗口（包括
在其他标签页的窗口）的缓冲文件都是“已加载”状态，其他曾经被编辑过但当前不可见
的缓冲文件则是“未加载”状态，不过 Vim 仍然记录着所有这些缓冲文件的列表。</li>
</ul>
<p>然后，Vim 还有个“当前位置”的概念。也就是光标所在的位置，决定了哪个是“当前缓冲
文件”，“当前窗口”与“当前标签页”。</p>
<p>有了这些概念，对 VimL 中的另外三个作用域前缀 <code>b:</code> <code>w:</code> <code>t:</code> 就容易理解了。其意
即指一个变量与特定的缓冲文件、窗口或标签页相关联的，以 <code>b:</code> 举例说明。</p>
<ul>
<li><code>b:varname</code> 表示在当前缓冲文件（实体对象）中存在一个名为 &quot;varname&quot; 的变量。</li>
<li>VimL 语句在执行过程中，只能直接引用当前缓冲文件的 <code>b:</code> 变量，如果要引用其他
缓冲文件的变量，要么先用其他命令将目标缓冲文件切换为当前编辑的缓冲文件，或者
调用其他的内置函数来访问。</li>
<li>如果一个缓冲文件“消失”了，那么与之关联的所有 <code>b:</code> 变量也消失了。</li>
<li>窗口与标签页的“消失”能比较形象与容易地理解，关闭了就算消失了。但 Vim 内部对
缓冲的管理比较复杂，未必是从窗口上不见了就代表“消失”了。</li>
<li>不过在一般 VimL 编程中，可暂不必深究缓冲文件什么时候“消失”。只要记着一个
<code>b:</code> 变量必定与一个缓冲文件关联着，不同的缓冲文件使用相同的 <code>b:</code> 变量是安全的，
它们互不影响。</li>
</ul>
<h3 id="zuo-yong-yu-qian-zhui-qi-shi-shi-ge-zi-dian">作用域前缀其实是个字典</h3>
<p>以上介绍的各种作用域前缀，不仅是种语法约定的标记，它们本身也是个变量，是可以容纳
保存其他变量的字典类型变量。关于字典，在后续章节再详述。这里只能介绍几个演示示
例来体会一下这种特性。</p>
<p>为了操作环境一致，也假设按上节的“裸装” Vim 启动：（不过其实不太影响，也不必太
拘泥）</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cd </span><span style="color:#bf616a;">~</span><span>/.vim/vimllearn
</span><span style="color:#bf616a;">$</span><span> vim</span><span style="color:#bf616a;"> -u</span><span> NONE helloworld.txt
</span></code></pre>
<p>现在已用 vim 打开了一个 <code>helloworld.txt</code> 文件。在命令行输入以下 ex 命令：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> x = </span><span style="color:#d08770;">1
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">g:x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">g:</span><span style="color:#b48ead;">.</span><span>x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">g:</span><span>[</span><span style="color:#a3be8c;">&#39;x&#39;</span><span>]
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">g:
</span></code></pre>
<p>你可以每次按冒号进入命令行逐行输入，也可以先进入 <code>Ex</code> 模式，连续输入这几行，效
果是一样的（以后不再注明）。</p>
<p>首先用 <code>:let</code> 命令定义了一个 <code>x</code> 变量，命令行语句默认是全局变量。然后用
<code>:echo</code> 命令使用几种不同写法来引用读取这个变量的值，这几种写法都是等效的。最后
将 <code>g:</code> 当作一个整体变量打印显示。它就是个全局字典，而里面包含了 <code>x</code> 键，值就
是 <code>1</code>。（如果按正常的 vim 启动，你的 vimrc 以及各种插件可能会提供很多全局变量
，那么 <code>echo g:</code> 的内容可能很多，不只 <code>x</code> 哟）</p>
<p>然后我们再写个脚本观察下 <code>s:</code> 变量。<code>:e hello2.vim</code>，输入以下内容并保存：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#65737e;">&quot; File: ~/.vim/vimllearn/hello2.vim
</span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">s:hello</span><span> = </span><span style="color:#d08770;">1
</span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">s:world</span><span> = </span><span style="color:#d08770;">2
</span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">s:hello_world</span><span> = </span><span style="color:#bf616a;">s:hello</span><span> + </span><span style="color:#bf616a;">s:world
</span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">s:
</span></code></pre>
<p>脚本写完了，在 ex 命令行输入以下几条测试下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: source </span><span style="color:#b48ead;">%
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">s:
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">s:hello
</span></code></pre>
<p>可见，<code>: source %</code> 命令能正常执行，脚本内的 <code>:echo s:</code> 打印出了该脚本内定义的
所有 <code>s:</code> 脚本变量。但在命令行直接试图访问 <code>s:</code> 变量则报错了。</p>
<p>在脚本中也可以访问全局变量。可以自行尝试在 <code>hello2.vim</code> 中加入对刚才在命令行定
义的 <code>g:x</code> 变量的访问。不过在实际的编程中，可千万别在脚本中依赖在命令行建立的
全局变量。</p>
<p>然后再测试下 <code>b:</code> 变量，直接在命令行执行以下语句吧：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">b:x</span><span> = </span><span style="color:#d08770;">2
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">b:x
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">g:x
</span><span>: e #
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">b:x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">b:
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> x
</span><span>: e #
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">b:x
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#bf616a;">b:
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> x
</span></code></pre>
<p>这里，<code>:e #</code> 表示切换编辑另一个文件。在实际工作中，或者用快捷键 <code>&lt;Ctrl-^&gt;</code> 更
方便，不过在本教程中，为说明方便，采用 ex 命令 <code>:e #</code> 。在本例中，vim 启动时
打开的文件是 <code>helloworld.txt</code>，后来又编辑了 <code>hello2.vim</code>；此时用 <code>:e #</code> 命令就
切回编辑 <code>helloworld.txt</code>了，再执行 <code>:e #</code> 就再次回到 <code>hello2.vim</code> 中，这是轮换
的效果。</p>
<p>这个示例结果表明，在编辑 <code>hello2.vim</code> 时定义了一个 <code>b:x</code> 变量，这与全局的 <code>x</code> 
变量是互不冲突的。但是在换到编辑 <code>helloworld.txt</code> 时，<code>b:x</code> 变量就不存在了，因
为并未在该缓冲文件中定义 <code>b:x</code> 变量呀。重新回到编辑 <code>hello2.vim</code> 文件时，<code>b:x</code>
变量又能访问了。这也说明当缓冲文件“不可见”时，vim 内部管理它的对象实体其实并未
“消失”呢。而全局变量 <code>g:x</code> 或 <code>x</code> 是始终能访问的。</p>
<p>最后要指出的是，局部作用域 <code>l:</code> 与参数作用域 <code>a:</code> 不能像 <code>s:</code> 或 <code>b:</code> 这样当作
整体的字典变量，是两个例外。VimL 这样处理的原因，可能一是没必要，二是没效率。
函数体内的局部作用域与参数作用域，太窄，没必要将局部变量另外保存一个字典；而且
有效时间太短，函数在栈上反复重建销毁，额外维护一个字典没有明显好处就不浪费了。
另外若要表示所有函数参数另有一个语法变量 <code>a:000</code> 可实现其功能。</p>
<h3 id="qi-ta-te-shu-bian-liang-qian-zhui-v">其他特殊变量前缀 $ v: &amp;</h3>
<p>这几个符号其实并不是作用域标记。不过既然也是变量前缀，也就一道说明一下，也好加
以区分。</p>
<p>含 <code>$</code> 前缀的变量是环境变量。除了 vim 在启动时会从父进程（如 shell）自动继承一
些环境变量，这些变量在使用上与全局变量没什么区别。不过要谨慎使用，一般建议只读
，不要随便修改，没必要的话也不要随便创建多余的环境变量。（实际上环境变量与全局
变量的最大区别是环境变量在 <code>ex</code> 命令中会自动展开为当前的具体值，比如可直接使用
<code>:e $MYVIMRC</code> 编辑启动加载的 <code>vimrc</code> 文件。但在 VimL 脚本中将环境变量当作全局
变量使用完全没问题）</p>
<p>含 <code>v:</code> 前缀的变量是 vim 内部提供的预定义常量或变量。用户不能增删这类特殊变量
，也不能修改其类型与含义。比如 <code>v:true</code> 与 <code>v:false</code> 分别用于表示逻辑值“真”与“
假”。Vim 所支持的这类 <code>v:</code> 变量往往随着版本功能的增加而增加。从与时俱进的角度
讲，vim 脚本中鼓励使用这类变量增加程序的可读性，但若想兼容低版本，还是考虑慎用
。要检查当前 vim 版本是否支持某个 <code>v:</code> 变量，只要用 <code>:help</code> 命令查阅一下即可。
而且 <code>v:</code> 本身也是个字典集合变量，可用 <code>:echo v:</code> 命令查看所有这类变量。</p>
<p>含 <code>&amp;</code> 前缀的变量表示选项的值，相当于把选项变量化，以便于在 VimL 中编程。所支持
的选项集，也是由 Vim 版本决定的，用户当然无法定义与使用不存在的选项。这部分内
容在后面讲选项设置时再行讨论。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch01-viml-feature/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
