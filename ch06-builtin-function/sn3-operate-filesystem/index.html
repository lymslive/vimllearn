<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>6.3 操作系统文件</h1>
    <!-- ## 6.3 操作外部系统资源 -->
<p>本节介绍的函数主要着眼于访问外部资源，比如最常用便是系统文件。</p>
<h3 id="wen-jian-xi-tong-xiang-guan-han-shu">文件系统相关函数</h3>
<ul>
<li>glob() 按文件通配符搜索文件</li>
<li>globpath() 在指定目录中搜索文件</li>
<li>findfile() 在搜索路径中查找文件</li>
<li>finddir() 在搜索路径中查找目录</li>
</ul>
<p><code>glob()</code> 函数的作用，就相当于在 linux 终端命令 <code>ls</code> 所能列出的文件名。它可接收
至多四个参数，只有第一个是必须的：</p>
<ul>
<li><code>{wildcard}</code> 通配符文件名模式，非正则表达式；</li>
<li><code>{nosuf}</code> 让两个选项生效，<code>&amp;wildignore</code> 可忽略某些文件，<code>&amp;suffixes</code> 按文件名
后缀影响结果的排序；</li>
<li><code>{list}</code> 提供该参数则返回列表类型，否则是用换行符分隔的字符串；</li>
<li><code>{alllinks}</code> 一般情况下只会找出存在的文件，对于软链接文件，则其指向的文件有
效才被包含在结果中，但若提供该参数，无效链接文件也接收。</li>
</ul>
<p>一般第三个参数比较常用，即将结果按列表返回，以 <code>glob(wild, 0, 1)</code> 方式调用。</p>
<p><code>globpath()</code> 用法是在 <code>glob()</code> 基础上，额外提供一个参数指定要哪些目录下搜索文
件，必选参数，且插在第一个参数位置上。这是一个以逗号分隔的目录名列表字符串，如
<code>&amp;rtp</code> 的表示法。例如 <code>globpath(&amp;rtp, 'readme.md')</code> 就能搜索出所有运行时目录下
的说明文档（目前许多插件安装习惯是安装在独立的运行时目录下，一般会有个
<code>readme.md</code> 说明文档）。</p>
<p><code>glob()</code> 函数将返回所有匹配的文件名，但 <code>findfile()</code> 或 <code>finddir()</code> 只返回第一
个匹配的文件名，一个查找文件，一个查找目录，类似命令 <code>:find</code> 的作用。接收三个
参数，只有第一个必选：</p>
<ul>
<li><code>{name}</code> 文件名，必须是全名，不是通配符；</li>
<li><code>{path}</code> 在这些目录下查找文件，也是逗号分隔的目录列表，省略的话用选项 <code>&amp;path</code>
代替。所以实际所查到的文件名类似 <code>{first-path}/{name}</code>。</li>
<li><code>{count}</code> 指定返回第几个匹配的文件，而不是第一个，负数时返回所有匹配文件组成
的列表类型变量。</li>
</ul>
<p>Vim 的 <code>:find</code> 命令及 <code>gf</code> 命令使用 <code>&amp;path</code> 选项值，这叫做搜索路径，这是搜索普
通文件的；不同于 <code>&amp;rpt</code> 运行时路径是搜索 vim 脚本的。搜索路径同时支持向下搜索
与向上搜索的机制，在 <code>{path}</code> 参数或 <code>&amp;path</code> 选项中使用特殊字符达成：</p>
<ul>
<li>向下搜索：<code>*</code> 表示任意字符，<code>**</code> 表示任意子目录；</li>
<li>向上搜索：<code>{one-path};{upto-path},{another-path}</code> 即在一个路径（逗号分隔的）
末尾再加一个分号，接一个相对基目录（<code>{one-path}</code>）更上层的目录（<code>{upto-path}</code>）
就能从指定目录开始向上搜索，依次在其父目录搜索，直到终止目录 <code>{upto-path}</code>。
终止目录可省，但分号不可省，否则在该目录中就认为不需要支持向上搜索。建议不限
定终止目录时写成 <code>{base-path};/,</code> 或 <code>{base-path};~,</code> 一直上溯到系统根目录或
自己的家目录。</li>
<li>相对 Vim 当前路径写成单点 <code>.</code> ，相对当前正编辑的文件缓冲的路径写成 <code>./</code>。</li>
</ul>
<p>向上搜索机制，对于搜索工程项目文件很有用。比如当你正在编辑一个源代码文件，它一
般被组织在各层子目录下，要找到项目文件就得使用向上机制了，例如 <code>.git/</code> 目录或
<code>tags</code> 文件，都一般放在项目顶层目录中。</p>
<ul>
<li>resolve() 解析链接文件名</li>
<li>simplify() 简化文件名路径</li>
<li>pathshorten() 缩写文件名的中间路径</li>
<li>fnamemodify() 文件名修饰</li>
</ul>
<p><code>resolve()</code> 是处理软链接文件（linux 系统）或快捷方式（MS-Windows 的 <code>.lnk</code>）的
，将其转为实际指向的文件名。在其他系统同 <code>simplify()</code> 简化处理。文件名需要简化
的一个例子是包含一系列的点号与双点号，如 <code>./dir/.././/file/</code> ，这可能是由其他
函数拼接而来。<code>simplify()</code> 简化后不改变其意义，如上例简化结果为 <code>./file/</code>。但
是 <code>pathshorten()</code> 只是简单地将中间路径都缩写至首字母，显然是不保证其有效意义
的。比如在默认的多标签页的名字，为节省屏幕空间就将当前编辑文件缩写目录名，
<code>~.vim/autoload/myfile.vim</code> 将简写为 <code>~/.v/a/myfile.vim</code>（如果觉得这比较丑，可
寻插件定制标签页栏）。</p>
<p>文件名修饰是指如何从一个文件名中获取其目录、全路径名、后缀名等相关的名字字符串
。函数 <code>fnamemodify({fname}, {mods})</code> 的第二参数就叫做修饰符，修饰符以冒号开头
带一个单字母表示不同意义，且可连续使用。主要的修饰符如：</p>
<ul>
<li><code>:p</code> 文件全路径名</li>
<li><code>:h</code> 父目录名（文件名头部，去除路径分隔符最后一部分）</li>
<li><code>:t</code> 文件名尾部（一般是 <code>:h</code> 剩余部分，纯文件名）</li>
<li><code>:e</code> 文件名后缀</li>
<li><code>:r</code> 文件名主体（相对于 <code>:e</code> 而言，不包括后缀，但可能包含父目录）</li>
</ul>
<p>注意 <code>fnamemodify()</code> 不处理特殊文件名变量，需用 <code>expand()</code> 先展开，不过后者也
可以直接加修饰符后缀。如以下两个语句等效：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">fnamemodify</span><span>(</span><span style="color:#8fa1b3;">expand</span><span>(</span><span style="color:#a3be8c;">&#39;%&#39;</span><span>), </span><span style="color:#a3be8c;">&#39;:p:t&#39;</span><span>)
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">expand</span><span>(</span><span style="color:#a3be8c;">&#39;%:p:t&#39;</span><span>)
</span></code></pre>
<ul>
<li>executable() 检查是否可执行程序</li>
<li>exepath() 可执行程序的全路径</li>
<li>filereadable() 文件是否可读</li>
<li>filewriteable() 文件是否可写</li>
<li>getfperm() 获取文件权限（类 <code>rwxrwxrwx</code> 字符串）</li>
<li>getftype() 获取文件类型</li>
<li>isdirectory() 检测目录是否存在</li>
<li>getfsize() 获取文件字节大小（目录返回 <code>0</code>）</li>
<li>getftime() 获取文件的最后修改时间（整数，按秒计）</li>
</ul>
<p>这几个函数用于检查指定文件的属性，其中 <code>getftype()</code> 返回的字符串主要有如：</p>
<ul>
<li>
<p><code>file</code> 普通文件</p>
</li>
<li>
<p><code>dir</code> 目录</p>
</li>
<li>
<p><code>link</code> 软链接文件</p>
</li>
<li>
<p><code>bdev</code> <code>cdev</code> <code>socket</code> <code>fifo</code> <code>other</code> 等</p>
</li>
<li>
<p>getcwd() 获取当前工作路径</p>
</li>
<li>
<p>haslocaldir() 检测当前窗口是否有局部当前路径（<code>:lcd</code>）</p>
</li>
</ul>
<p>这两个函数都可选带两个参数，指定窗口编号与标签页编号，因为取当前窗口的当前路径
。Vim 启动时，从 shell 环境中继续当前路径，这是全局当前路径，可用 <code>:cd</code> 命令修
改。每个窗口可有自己的局部当前路径，这用 <code>:lcd</code> 修改。如果从未用过 <code>:lcd</code> ，窗
口的局部当前路径就与全局当前路径相同。新分裂的窗口继承原窗口的当前路径。<code>:pwd</code>
打印的是全局当前路径，因此有可能与 <code>getcwd()</code> 不同。</p>
<ul>
<li>mkdir() 创建新目录（类似 <code>$mkdir</code>）</li>
<li>delete() 删除文件（类似 <code>$rm</code>）</li>
<li>rename() 重命名文件（类似 <code>$mv</code>）</li>
<li>readfile() 读文件至一个字符串列表</li>
<li>writefile() 将字符串列表写入文件</li>
</ul>
<p>这几个文件操作函数，除了 <code>readfile()</code> 返回列表外，其他函数在操作成功时返回 <code>0</code>
，失败时返回非零错误码。其功能与相应的 linux 命令类似，不过将命令行参数改成函
数调用参数。如 <code>mkdir('name', 'p')</code> 类似 shell 命令 <code>$mkdir -p name</code> 可以自动
创建中间目录；<code>delete()</code> 删除非空目录时必须加参数 <code>rf</code>（谨慎）；<code>rename()</code> 重
命名文件可能覆盖已有文件无警告。当然这些操作也涉及系统权限。</p>
<p>读文件函数支持三个参数，<code>readfile(fname, binary, max)</code> ，后两个是可选的。默认
是按文本格式读入，主要会处理换行符。如果提供 <code>{binary}</code> 参数，按二进制格式读入
，虽然也会根据换行符分隔为列表元素，但元素中可能再保留回车符（dos 格式的文件）
，且最后可能多加一个空元素（若文件末尾是换行符）。第三个可选参数 <code>{max}</code> 可指
定只读入前几行，类似 linux 命令 <code>$head -n</code> ，但如果 <code>{max}</code> 参数是负数，则只读
入末尾几行，类似命令 <code>$tail -n</code>。</p>
<p>写文件函数要求两个参数，作为内容的字符串列表，以及文件名，还有个可选参数标记：
<code>writefile(list, fname, flags)</code>。标记 <code>{flags}</code> 若包含 <code>b</code> 则按二进制格式写入
，若包含 <code>a</code> 则添加到原文件末尾，否则是覆盖原文件。</p>
<p>一般情况下，Vim 是处理文件文本的，在使用这两个读写文件函数时，没必要指定 <code>b</code>
二进制格式。但是按二进制格式先 <code>readfile()</code> 再 <code>writefile()</code> 确实能达到复制文
件的作用。</p>
<h3 id="diao-yong-wai-bu-xi-tong-ming-ling">调用外部系统命令</h3>
<p>在 Vim 的命令行中，可用 <code>:!</code> 叹号开头，调用外部系统命令。而在 VimL 脚本中，相
应功能的函数是 <code>system()</code>。</p>
<ul>
<li>system() 执行系统命令，结果为字符串形式返回</li>
<li>systemlist() 执行系统命令，结果以列表形式返回</li>
<li>libcall() 调用外部库函数，结果返回字符串</li>
<li>libcallnr() 调用外部库函数，结果返回数字</li>
</ul>
<p><code>system(cmd, input)</code> 将字符串 <code>{cmd}</code> 当作系统命令执行，返回字符串结果。如果
<code>{cmd}</code> 命令需要输入，则可提供可选参数 <code>{input}</code> ，一般也是字符串，首先写入临
时文件，再当作标准输入传给 <code>{cmd}</code> 。如果 <code>{input}</code> 是字符串列表，则以二进制
<code>b</code> 方式调用 <code>writefile()</code> 写入临时文件。</p>
<p><code>{cmd}</code> 命令字符串不支持管道。并且为了安全与正确性起见，最好调用
<code>shellescape()</code> 转义特殊字符。<code>systemlist()</code> 用法类似，只是返回结果是字符串列
表。</p>
<p><code>libcall()</code> 类似于 <code>call()</code> 的基础用法，只是调用外库（<code>.so</code> 或 <code>.dll</code>）的函数，
故需要库名、函数名与参数列表。当然不能随意调用外部库，只能调用专为扩展 vim 的
库，那才比较安全与实用。该函数将结果返回为字符串，另一个 <code>libcallnr()</code> 函数返
回的是数字结果。</p>
<ul>
<li>hostname() 获取 vim 所在运行的系统（计算机）名字</li>
<li>getpid() 获取 vim 运行的进程号 PID</li>
<li>tempname() 获取可用于临时文件的文件名</li>
</ul>
<p>在实现比较复杂的功能时，可能需要用到临时文件，用 <code>tempname()</code> 获得一个可用的文
件名（保证不重名）。也可以自己根据进程 PID 构建有规律的临时文件名。</p>
<h3 id="ri-qi-shi-jian-han-shu">日期时间函数</h3>
<ul>
<li>localtime() 获取当前时间</li>
<li>strftime() 格式化时间</li>
<li>reltime() 获取相对时间</li>
<li>reltimestr() 将相对时间转为字符串</li>
<li>reltimefloat() 格式化相对时间转为浮点数</li>
</ul>
<p><code>localtime()</code> 用于获取当前的标准时间，即从 1970 年至今的秒数。将这样的时间转为
可读模式，用 <code>strftime(format, time)</code> 函数，缺省 <code>{time}</code> 参数时，取当前时间，
相当于先调用 <code>localtime()</code>。可用时间格式 <code>{format}</code> 与 C 语言的同名标准函数相
同，如 <code>strftime('%Y-%m-%d')</code> 将返回类似 <code>2017-11-11</code> 的字符串。</p>
<p><code>reltime()</code> 返回更精确的时间，具体格式与系统有关。无参数调用返回当前时间，一个
参数 <code>reltime(start)</code> 返回从开始时刻（<code>{start}</code>也应该是由该函数返回的）到现在
所经过的时间，两个参数 <code>reltime(start, end)</code> 返回两个时刻之间的时间。用
<code>reltimestr()</code> 将这样的时间转为字符串表示，<code>reltimefloat()</code> 转为浮点数表示，因
为字符串表示法也正像个浮点数（即秒数加小数点加毫秒数）。因其精确到毫秒，可用来
计算命令或函数执行的时间。</p>
<h3 id="yong-hu-jiao-hu-han-shu">用户交互函数</h3>
<ul>
<li>input() 获得用户从命令行输入的一行文本</li>
<li>inputsave() 保存用户输入序列</li>
<li>inputrestore() 恢复用户输入序列</li>
<li>inputsecret() 按密文输入</li>
<li>intputdialog() 从对话框中输入一行文本</li>
</ul>
<p>在 VimL 脚本中与用户交互的最常用的函数是 <code>input(提示, 默认值, 补全方法)</code>。提示
字符串参数必须给，可以是空字符串，也可以用 <code>\n</code> 表示多行提示。后面两个参数可选
。Vim 首先在命令打印提示字符串，等待用户输入一行文本，按回车返回用户刚输入的这
行文本。如果直接回车没任何输入，则返回传给函数的默认值（或空字符串）。当用户输
入时，相当于编辑命令行，所以为便于用户输入，可提供补全方法，类似自定义命令那般
。而且用户的输入也有独立的命令行历史记录。</p>
<p>显然，<code>input()</code> 函数不宜用于启动配置 vimrc 中。此外，也要避免用于映射中，因为
映射的后续键相当于用户输入，会当作 <code>input()</code> 的回应输入。如果一定要用于映射中
，请在调用 <code>input()</code> 前后分别调用 <code>inputsave()</code> 与 <code>inputrestore()</code>。</p>
<p><code>inputsecret()</code> 用法一样，只是用户输入的文本不直接显示在屏幕命令行中，以星号
<code>*</code> 代替。此外也不支持补全，不放入历史记录中，因为这主要用于提示输入密码。</p>
<p>在 GUI 版本中，<code>inputdialog()</code> 可弹出对话框，让用户从对话框中输入，否则类似
<code>input()</code> 函数。</p>
<ul>
<li>inputlist() 让用户从一个列表中选择一项</li>
<li>confirm() 也是让用户从列表中选择一项</li>
</ul>
<p><code>inputlist()</code> 接收一个字符串列表参数，Vim 将每个元素一行显示在命令行上方的消息
区，然后提示用户输入一个数字选择一项（GUI 版本可用鼠标）。注意按列表索引惯例，
<code>0</code> 表示选择第一项。为弥补这个反人类设计，这有个技巧：将提示文本写在列表的第一
项，后续有效选项字符串也以索引 <code>1.</code> <code>2.</code> 之类的开始，让用户能直观地选择数字。</p>
<p>让用户做选择还有另一个函数 <code>confirm()</code> ，它可用于 GUI 版本，也可用于终端版本。
它可接收四个参数，<code>confirm(提示，选项列表，默认选项，对话框类型)</code>，一般只用到
前两个。与 <code>inputlist()</code> 不同的是，提示文本为独立参数，且选项列表是字符串，用
回车分隔每一选项，且第一项是 <code>1</code> 。在每一项的字符串中，可以将 <code>&amp;</code> 加在某个字符
之前，则按该字符时直接选择了项目（选择快捷键），且不像 <code>inputlist()</code> 那样会将
所按键显示在命令行中（因为其实这是为GUI版本设计的），也不需要多按回车确认，就
是快捷键直接选择。当然函数返回的仍是选项索引，并非快捷键字符。可选的默认选项参
数也应该是数字索引，不提供时默认 <code>0</code> ，算是无效选项。</p>
<ul>
<li>getchar() 获取用户按下的下一个键</li>
<li>getcharmod() 获取用户按键时的修饰键</li>
<li>feedkeys() 将一个字符串放入 vim 待响应的按序序列</li>
</ul>
<p><code>getchar()</code> 用于获取用户（或输入流）的下一个键。不同于 <code>input()</code> 进入命令行等
待交互，而是默默地等待获取下一输入键。相对细节很多，用到时请参考文档。因为 vim
本身的总体工作（消息）循环，就是等待用户按键，然后作出不同响应。</p>
<p><code>getcharmod()</code> 用于获取修饰键（收到上个键时同时按下的修饰键），如 <code>shift = 2</code>
、<code>ctrol = 4</code> 、<code>alt = 8</code> 等。将可用修改键用二进制编码，返回一个数字就能表示哪
些修饰键被按下了。</p>
<p><code>feedkeys()</code> 的用途就比较诡秘了。它把一个字符串放回输入流中，当作是用户的按键
输入序列。特殊按键用 <code>&quot;\&lt;标记&gt;&quot;</code> 表示。默认情况下，放回的这些字符键是可再
被重映射的，然而也有一些可选参数控制细节。</p>
<ul>
<li>browse() 打开浏览文件对话框</li>
<li>browsedir() 打开目录选择对话框</li>
</ul>
<p>这两个函数只能用于 GUI 版本，弹出标准对话框，让你选择一个文件或目录，返回所选
择的文件路径名。可以传入参数指定对话框标题及初始浏览目录。</p>
<ul>
<li>getfontname() 获取当前所用的字体</li>
<li>getwinposx() 获取 gVim 窗口的坐标</li>
<li>getwinposy() 获取 gVim 窗口的坐标</li>
</ul>
<p>这几个函数只能用于 GUI 版本，检索 GUI 才用得到的信息。</p>
<h3 id="yi-bu-tong-xun-han-shu">异步通讯函数</h3>
<p>自 Vim8 版本引入了一些全新的特性：任务（job）、定时器（timer）、通道（channel），
这都涉及异步编程，主要通过回调函数实现功能。为此也提供了一系列相关的内建 api
函数。不过本章不想罗列这些函数，毕竟需要理解相应的功能才有理解函数用法的意义。
留待后续章节专门讨论吧。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch06-builtin-function/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
