<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>6.1 操作数据类型</h1>
    <!-- ## 6.1 操作数据类型 -->
<h3 id="zi-fu-chuan-yun-suan">字符串运算</h3>
<p>Vim 是文本编辑器，所以处理文本字符串是一重点任务。每个字符在计算机内部都用一个
整数表示（即编码值，与用数字字符组成表示的可读整数不同概念），具体如何对应取决
于编码系统（有时简称编码）。目前计算机界的趋势是用 <code>utf-8</code> 编码表示 Unicode 字
符集，因为它与最早的 ASCII 编码兼容。一个汉字在此编码下用 3 个字节表示，英文字
符仍用一个字节表示。</p>
<ul>
<li>nr2char() 将编码值转为字符</li>
<li>char2nr() 将字符转为编码值</li>
<li>str2nr() 将字符串转为整数</li>
<li>str2float() 将字符串转为浮点数</li>
</ul>
<p>由于 VimL 没有字符串类型，<code>char2nr()</code> 其实是将字符串首字符转为编码值的。默认按
<code>utf-8</code> 编码获取编码值与字符的对应，但可传入额外参数按其他编码系统对应。例如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">char2nr</span><span>(</span><span style="color:#a3be8c;">&#39;中国&#39;</span><span>) |</span><span style="color:#65737e;">&quot; --&gt; 20013
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">nr2char</span><span>(</span><span style="color:#d08770;">20013</span><span>)  |</span><span style="color:#65737e;">&quot; --&gt; 中
</span></code></pre>
<p>整数类型与字符串一般可自动转换，一般用不上 <code>str2nr()</code> 。但如果从安全考虑习惯主
动判断类型的话，要注意从命令行输入的参数都是字符串，不是整数。此外，字符串不会
自动转为浮点数，而是截断为整数，所以确实要处理浮点数是，用 <code>str2float()</code> 转换
。</p>
<ul>
<li>printf() 格式化字符串</li>
</ul>
<p>简单的字符串连接用连接操作符 <code>.</code> 即可。要组装复杂字符串时可用 <code>printf()</code> 函数
，通过字符串模式与 <code>%</code> 占位符，插入变量。其用法与 C 语言的 <code>sprintf()</code> 类似，
因为该函数会返回结果字符串，“打印”字符串用 <code>:echo</code> 命令。</p>
<ul>
<li>escape() 将字符串中指定的字符用反斜杠 <code>\</code> 转义</li>
<li>shellescape() 转义特殊字符以适于 shell 命令</li>
<li>fnameescape() 转义特殊字符以适于 Vim 命令，主要用于转义文件名参数</li>
</ul>
<p>当组装字符串用于当作命令执行时，为安全起见，应先调用 <code>shellescape()</code> 或
<code>fnameescape()</code> 进行转义。这两个函数自有其转义策略，适用大部分情况。当有特殊需
求时，可用 <code>escape()</code> 指定要转义哪些字符（传入第二参数的字符串中出现的所有字符
都表示要转义的）。</p>
<ul>
<li>tolower() 将字符中转为小写</li>
<li>toupper() 将字符串转为大写</li>
<li>tr() 按一一对应的方式转换字符串</li>
<li>strtrans() 将字符串转换为可打印字符串</li>
</ul>
<p><code>tr()</code> 函数进行简单的字符串转换（不是正则替换），效果如同 unix 工具 <code>tr</code>。大小
写转换是其一种特例策略，如转大写相当于 <code>tr(str, 'abcdefg...', 'ABCDEFG...')</code>。
而 <code>strtrans()</code> 是按 vim 的自定策略将不可打印字符转换为可视字符（组合，一般以
<code>^</code> 开头）表示。</p>
<ul>
<li>strlen() 按字节数获取字符串长度</li>
<li>strchars() 按字符数获取字符串长度，当含宽字符（如汉字时）与字节长度有差异</li>
<li>strwidth() 字符串宽度，显示在屏幕上时将占用的列宽度，但未处理制表符</li>
<li>strdisplaywidth() 字符串实际显示宽度，并按设置处理制表符宽度</li>
<li>byteidx() 第几个字符的字节索引，不单独处理组合字符</li>
<li>byteidxcomp() 也是字符索引转为字节索引，组合字符单独处理</li>
</ul>
<p>字符串可像列表一样用中括号索引，那是按字节索引的。当字符串中存在宽字符时，字符
数与字节数不一致，这就需要处理字符索引与字节索引的不同。请仔细观察以下示例：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">let</span><span> str = </span><span style="color:#a3be8c;">&#39;vim 中国&#39;
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">strlen</span><span>(str)    |</span><span style="color:#65737e;">&quot; --&gt; 10
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">strchars</span><span>(str)  |</span><span style="color:#65737e;">&quot; --&gt; 6（vim 加空格加两汉字）
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">len</span><span>(str)       |</span><span style="color:#65737e;">&quot; --&gt; 10
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">strwidth</span><span>(str)  |</span><span style="color:#65737e;">&quot; --&gt; 8（每个汉字三字节但两宽度）
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str[</span><span style="color:#d08770;">0</span><span style="color:#b48ead;">:</span><span style="color:#d08770;">2</span><span>]       |</span><span style="color:#65737e;">&quot; --&gt; vim
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str[</span><span style="color:#d08770;">4</span><span>]         |</span><span style="color:#65737e;">&quot; --&gt; &lt;e4&gt;（中字的第一个字节）
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str[</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">:</span><span style="color:#d08770;">5</span><span>]       |</span><span style="color:#65737e;">&quot; --&gt; &lt;e4&gt;&lt;b8&gt;
</span><span>: </span><span style="color:#96b5b4;">echo</span><span> str[</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">:</span><span style="color:#d08770;">6</span><span>]       |</span><span style="color:#65737e;">&quot; --&gt; 中
</span></code></pre>
<p>组合字符（有的书籍叫重音字符），中国人一般不必关注，欧洲人才用得到。比如 <code>é</code>
是通过一个正常的 <code>e</code> 字母加上重音符组成而成的（<code>'e' . nr2char(0x301)</code>），显示
上像是一个字符，但计算机要用两个字符表示。至于算一个字符还是两个字符，似乎都有
理有据，所以就提供了不同的函数或可选参数来处理这种情况。这与汉字宽字符的情况不
一样。汉字的三个字节是不可分的，取第一字节是无效字符。但组合字符的第一字节仍是
个有效字符（字母）。</p>
<p>字符与编码看似简单，如同空气与水一样简单，但深入细处还挺复杂。所以建议初学者不
必深究，始终用英文文本示例测试学习即可。当实际工作中遇到中文问题时再回头查阅。
此外，据说早期的中国程序员常要念经“一个汉字等于两个字节”，那是用 GB 编码的原因
，现在请升级经文“一个汉字等于三个字节”。</p>
<ul>
<li>stridx() 查找一个短字符串在另一个长字符串第一次出现的起始索引</li>
<li>strridx() 查找一个短字符串在另一个长字符串最后一次出现的起始索引</li>
<li>strpart() 截取字符串从某个索引开始的定长子串</li>
</ul>
<p>查找简单子串存在情况可用 <code>stridx()</code> ，要求精确匹配，且大小写敏感。返回的结果索
引是字节索引，索引从 0 开始，若不存在子串返回 -1。截取子串可用中括号索引切片方
式，如上例 <code>str[4:6]</code>，参数是起始索引与终止索引（含双端）。而 <code>strpart()</code> 的参
数是起始索引与长度，如上例等效于 <code>strpart(str, 4, 3)</code>。</p>
<ul>
<li>match() 查找一个正则表达式在字符串出现的起始索引，不匹配时返回 -1</li>
<li>matchend() 查找一个正则表达式在字符串出现的终止索引</li>
<li>matchstr() 返回字符串中匹配正则表达式的部分，不匹配时返回空串</li>
<li>matchlist() 将正则匹配结果按分组返回至列表中，不匹配时返回空列表</li>
<li>substitute() 正则表达式替换，<code>:s</code> 命令的函数式</li>
<li>submatch() 获取正则匹配的分组子串，只可用于 <code>:s</code> 命令的替换部分</li>
</ul>
<p>这几个函数用于处理正式表达式的匹配查找与替换。如果仅是要判断是否匹配，可直接用
操作符 <code>if str =~# pattern</code>。<code>match()</code> 函数主要是还能返回匹配成功的起始索引，
相应地 <code>matchend()</code> 返回的是终止索引。<code>matchstr()</code> 返回的是匹配到的整个子串。
如果正则表达式中有括号分组 <code>\(\)</code>，最好用 <code>matchlist()</code> 函数，它返回的列表中，
第一个元素（<code>[0]</code>）就是匹配到的整个子串，其后是按顺序的分组子串。其中的关系可
用如下伪代码表示：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">let</span><span> s = some_string
</span><span style="color:#96b5b4;">let</span><span> p = search_pattern
</span><span style="color:#b48ead;">if</span><span> some_string </span><span style="color:#b48ead;">=~#</span><span> search_pattern
</span><span>    </span><span style="color:#96b5b4;">let</span><span> sidx = </span><span style="color:#8fa1b3;">match</span><span>(s, p)
</span><span>    </span><span style="color:#96b5b4;">let</span><span> eidx = </span><span style="color:#8fa1b3;">match</span><span>(s, p)
</span><span>    sidx </span><span style="color:#b48ead;">!= </span><span style="color:#d08770;">-1</span><span>; eidx </span><span style="color:#b48ead;">!= </span><span style="color:#d08770;">-1
</span><span>    s[sidx</span><span style="color:#b48ead;">:</span><span>eidx] </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">mathcstr</span><span>(s, p)
</span><span>    </span><span style="color:#96b5b4;">let</span><span> slist = </span><span style="color:#8fa1b3;">matchlist</span><span>(s, p)
</span><span>    slist[</span><span style="color:#d08770;">0</span><span>] </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">matchstr</span><span>(s, p) </span><span style="color:#b48ead;">== </span><span style="color:#bf616a;">&amp; </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">submatch</span><span>(</span><span style="color:#d08770;">0</span><span>)
</span><span>    slist[</span><span style="color:#d08770;">1</span><span>] </span><span style="color:#b48ead;">== \</span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">submatch</span><span>(</span><span style="color:#d08770;">1</span><span>)
</span><span>    slist[</span><span style="color:#d08770;">2</span><span>] </span><span style="color:#b48ead;">== \</span><span style="color:#d08770;">2 </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">submatch</span><span>(</span><span style="color:#d08770;">2</span><span>)
</span><span>    </span><span style="color:#b48ead;">...
</span><span style="color:#b48ead;">endif
</span></code></pre>
<p>替换函数 <code>substitute()</code> 的参数及意义与 <code>:substitute</code> 命令的几个部分完全一样。
不过命令可以缩写为 <code>:s</code>，函数不可以缩写。如以下两个语句功能类似：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: s</span><span style="color:#96b5b4;">/pat/</span><span>sub/flag |</span><span style="color:#65737e;">&quot; 对当前行替换 pat 为 sub
</span><span>: call </span><span style="color:#8fa1b3;">substitute</span><span>(</span><span style="color:#8fa1b3;">line</span><span>(</span><span style="color:#a3be8c;">&#39;.&#39;</span><span>), pat, sub, flag)
</span></code></pre>
<p>在替换部分 <code>{sub}</code> 可用表达式，以 <code>\=</code> 开始即可，如此 <code>submatch()</code> 表示前面
<code>{pat}</code> 部分的分组子串。而在以常规字面字符串表示 <code>{sub}</code> 部分时，则用 <code>\1</code> 表
示分组子串。</p>
<ul>
<li>string() 将其他任意变量或表达式转为字符串表达，类似 <code>:echo</code> 的显示</li>
<li>expand() 将具有特殊意义的标记（如 <code>% # &lt;cword&gt;</code> 等）展开</li>
<li>iconv() 转换字符串编码</li>
<li>repeat() 将字符串重复串接多次生成长字符串</li>
<li>eval() 将字符串当作表达式来执行，并返回结果</li>
<li>execute() 将字符串当作命令来执行，将结果返回为字符串</li>
</ul>
<p>注意，<code>eval()</code> 与 <code>execute()</code> 很灵活，但比较低效，也可能有一定风险。如有其他更
优雅的实现写法，尽量用替代方案。</p>
<h3 id="fu-dian-shu-xue-yun-suan">浮点数学运算</h3>
<p>用 VimL 做数学运算并不常见，但如果啥时想到需要她，她也在那儿。一般整数运算直接
用操作符，浮点运算才需要调用函数，且这些内置函数的结果一般也是浮点数，即使参数
都是整数。</p>
<ul>
<li>float2nr() 将浮点数转为整数类型</li>
<li>trunc() 截断取整</li>
<li>round() 四舍五入取整</li>
<li>floor() 向下取整</li>
<li>ceil() 向上取整</li>
</ul>
<p>这几个函数都是取整运算，但实际上只有 <code>float2nr()</code> 的结果是整数类型（
<code>v:t_number</code>），其他函数取整后仍为浮点数（<code>v:t_float</code>）。<code>float2nr()</code> 与
<code>trunc()</code> 意义一样是截断取整。当涉及负数，取整可能不太直观，请看示例：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">float2nr</span><span>(</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>) </span><span style="color:#8fa1b3;">float2nr</span><span>(</span><span style="color:#d08770;">-4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>) |</span><span style="color:#65737e;">&quot; --&gt; 4 -4
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">trunc</span><span>(</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>) </span><span style="color:#8fa1b3;">trunc</span><span>(</span><span style="color:#d08770;">-4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>)   |</span><span style="color:#65737e;">&quot; --&gt; 4.0 -4.0
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>) </span><span style="color:#8fa1b3;">round</span><span>(</span><span style="color:#d08770;">-4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>)   |</span><span style="color:#65737e;">&quot; --&gt; 5.0 -5.0
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">floor</span><span>(</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>) </span><span style="color:#8fa1b3;">floor</span><span>(</span><span style="color:#d08770;">-4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>)   |</span><span style="color:#65737e;">&quot; --&gt; 4.0 -5.0
</span><span>: </span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">ceil</span><span>(</span><span style="color:#d08770;">4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>) </span><span style="color:#8fa1b3;">ceil</span><span>(</span><span style="color:#d08770;">-4</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">56</span><span>)     |</span><span style="color:#65737e;">&quot; --&gt; 5.0 -4.0
</span></code></pre>
<p>当四舍五入正好在中值时（如小数部分是 0.5），取远离 0 那个整数，类似：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>: </span><span style="color:#8fa1b3;">round</span><span>(+float) </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">trunc</span><span>(+float + </span><span style="color:#d08770;">0</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">5</span><span>) |</span><span style="color:#65737e;">&quot; --&gt; 正数取整
</span><span>: </span><span style="color:#8fa1b3;">round</span><span>(-float) </span><span style="color:#b48ead;">== </span><span style="color:#8fa1b3;">trunc</span><span>(-float - </span><span style="color:#d08770;">0</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">5</span><span>) |</span><span style="color:#65737e;">&quot; --&gt; 负数取整
</span></code></pre>
<ul>
<li>fmod() 取余数</li>
<li>pow() 取幂</li>
<li>sqrt() 开平方</li>
</ul>
<p>整数取余数可直接用操作符 <code>%</code> ，该操作符不能用于浮点数。<code>fmod()</code> 可用于浮点数的
取余，即使整数也当作浮点处理。VimL 并没有整数取幂的操作符（其他语言有用 <code>^</code> 或
<code>**</code> 作幂运算的），须用 <code>pow()</code> 函数求幂，结果也总是浮点数；</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">echo </span><span style="color:#d08770;">10 </span><span style="color:#b48ead;">% </span><span style="color:#d08770;">3</span><span>          |</span><span style="color:#65737e;">&quot; --&gt; 1
</span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">fmod</span><span>(</span><span style="color:#d08770;">10</span><span>, </span><span style="color:#d08770;">3</span><span>)     |</span><span style="color:#65737e;">&quot; --&gt; 1.0
</span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">pow</span><span>(</span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">10</span><span>)      |</span><span style="color:#65737e;">&quot; --&gt; 1024.0
</span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">pow</span><span>(</span><span style="color:#d08770;">4</span><span>, </span><span style="color:#d08770;">1</span><span style="color:#96b5b4;">/2)     |&quot; --&gt; 1.0 （先计算 1/</span><span style="color:#d08770;">2</span><span> = </span><span style="color:#d08770;">0</span><span>）
</span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">pow</span><span>(</span><span style="color:#d08770;">4</span><span>, </span><span style="color:#d08770;">1</span><span>/</span><span style="color:#d08770;">2</span><span style="color:#b48ead;">.</span><span style="color:#d08770;">0</span><span>)   |</span><span style="color:#65737e;">&quot; --&gt; 2.0
</span><span style="color:#96b5b4;">echo </span><span style="color:#8fa1b3;">sqrt</span><span>(</span><span style="color:#d08770;">4</span><span>)         |</span><span style="color:#65737e;">&quot; --&gt; 2.0
</span></code></pre>
<ul>
<li>exp() 自然指数</li>
<li>log() 自然对数，以 <code>e = 2.718282</code> 为底</li>
<li>log10() 常用对数，以 <code>10</code> 为底</li>
<li>三角函数与反三角函数：sin() cos() asin() acos() 等</li>
</ul>
<p><code>log()</code> 是 <code>exp()</code> 的反函数，在数学上的记号是 <code>ln</code>；而数学上记为 <code>lg</code> 的对数，
程序上是 <code>log10()</code>。这个命令习惯应该是源自 C 语言的标准库函数。同样，一众三角
函数也是类似 C 语言的，参数是以弧度单位表示的角度。不过很难想像需要在 VimL 中
用到这些略为高深的数学计算的场景。</p>
<ul>
<li>isnan() 判断是否为非数</li>
</ul>
<p>自 Vim8 引入非数的判断。像 <code>0/0</code> 这样的计算结果叫非数，在其他一些计算机语言与
文档中习惯用 <code>NaN</code> 来表示。可能为了更好地与其他数据文件交互，Vim 也增加这个函
数来处理非数。</p>
<h3 id="lie-biao-yu-zi-dian-yun-suan">列表与字典运算</h3>
<p>在第四章介绍数据结构时，已经顺便介绍了操作列表与字典的函数。这里不再重复，只作
些补充说明。</p>
<p>首先，很多函数可同时作用于列表与字典，甚至字符串。因为脚本语言弱类型的缘故，没
法限定传入函数的参数，只能根据参数类型作出不同的合理反馈。例如：</p>
<ul>
<li>len() 取列表或字典集合中元素个数，也取字符串的（字节）长度</li>
<li>empty() 可判断是否空列表、空字典或空字符串，整数 0 也认为是空的</li>
<li>match() 还能匹配字符串列表，返回能匹配成功的元素索引</li>
</ul>
<p>其次，列表与字典都是集合，有一类高阶函数，可接收另一个函数（引用）作为参数，用
于处理集合内的每一个元素。比如 <code>map()</code> 与 <code>filter()</code> 函数。</p>
<p>前面提及，VimL 有许多与命令同名的函数，都是实现类似的功能。但 <code>map()</code> 是例外，
它与定义键映射的 <code>:map</code> 命令没有语义关系，完全是不同的概念。</p>
<ul>
<li>map({expr1}, {expr2}) 修改集合的每个元素</li>
</ul>
<p>其中参数一 <code>{expr1}</code> 可以是列表如字典，参数二 <code>{expr2}</code> 是函数引用。参数一集合
的每个元素，传给参数二所代表的函数，将结果值替换原来的元素。最终会原位修改列表
或字典。关键是参数二所引用的函数定义要遵循一定的规范，它应接收两个参数，<code>map()</code>
会将每个元素的索引与值传给该函数（字典元素的索引即是键名）。整个流程可如下模拟：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">MapDict</span><span>(dict, </span><span style="color:#b48ead;">fun</span><span>)
</span><span>    </span><span style="color:#b48ead;">for</span><span> [</span><span style="color:#bf616a;">l:key</span><span>, </span><span style="color:#bf616a;">l:val</span><span>] </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">items</span><span>(</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>dict)
</span><span>        </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:val_new</span><span> = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span style="color:#8fa1b3;">fun</span><span>(</span><span style="color:#bf616a;">l:key</span><span>, </span><span style="color:#bf616a;">l:val</span><span>)
</span><span>        </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>dict[</span><span style="color:#bf616a;">l:key</span><span>] = </span><span style="color:#bf616a;">l:val_new
</span><span>    </span><span style="color:#b48ead;">endfor
</span><span style="color:#b48ead;">endfunction
</span><span>
</span><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">MapList</span><span>(list, </span><span style="color:#b48ead;">fun</span><span>)
</span><span>    </span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">l:idx </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">range</span><span>(</span><span style="color:#8fa1b3;">len</span><span>(</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list))
</span><span>        </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:val</span><span> = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>list[</span><span style="color:#bf616a;">l:idx</span><span>]
</span><span>        </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:val_new</span><span> = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span style="color:#8fa1b3;">fun</span><span>(</span><span style="color:#bf616a;">l:idx</span><span>, </span><span style="color:#bf616a;">l:val</span><span>)
</span><span>        </span><span style="color:#96b5b4;">let a</span><span style="color:#b48ead;">:</span><span>list[</span><span style="color:#bf616a;">l:idx</span><span>] = </span><span style="color:#bf616a;">l:val_new
</span><span>    </span><span style="color:#b48ead;">endfor
</span><span style="color:#b48ead;">endfunction
</span></code></pre>
<p>如果处理每个元素的函数很简单，则可不必创建函数再传入函数引用。可用一个字符串代
替，该字符串调用 <code>eval()</code> 执行后，将结果替换原元素。在字符串中，用内置变量
<code>v:val</code> 代表迭代的每个元素值，<code>v:key</code> 代表元素索引（键名）。相当于传入函数版本
的两个参数。用这种方法得注意字符串的转义，建议用单引号括起字面字符串。可用其他
字符串函数或操作符组装，最终结果的字符串再调用 <code>eval()</code> 计算结果新值。</p>
<p>事实上，在低版本的 vim 中， <code>map()</code> 函数的参数二只能用字符串。这才需要 <code>v:key</code>
与 <code>v:val</code> 这两个特殊变量标记置于可执行字符串中。自 vim8 后，强烈建议使用函数
引用参数。这就无须理解 <code>v:key</code> 与 <code>v:val</code> 的即时意义。不过在定义处理元素的函数
时，建议也用 <code>key</code> 与 <code>val</code> 作为函数形参，这使整个代码的可读性更佳：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">MapHandle</span><span>(key, val) abort
</span><span>    </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:result</span><span> = deal with </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>key and </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>val
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">l:result
</span><span style="color:#b48ead;">endfunction
</span></code></pre>
<p>如果处理函数很简单，也可不必预定义函数，即时定义 lambda 也可以，因为 lambda 表
达式的值也正是一个函数引用。例如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">let</span><span> list</span><span style="color:#d08770;">1</span><span> = [</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>]
</span><span style="color:#96b5b4;">let</span><span> list</span><span style="color:#d08770;">2</span><span> = </span><span style="color:#96b5b4;">map</span><span>(list</span><span style="color:#d08770;">2</span><span>, {idx, val -&gt; val </span><span style="color:#b48ead;">* </span><span style="color:#d08770;">2</span><span>})
</span><span style="color:#96b5b4;">echo</span><span> list</span><span style="color:#d08770;">1
</span><span style="color:#96b5b4;">echo</span><span> list</span><span style="color:#d08770;">2
</span><span>
</span><span style="color:#96b5b4;">let</span><span> list</span><span style="color:#d08770;">3</span><span> = </span><span style="color:#96b5b4;">map</span><span>(</span><span style="color:#8fa1b3;">copy</span><span>(list</span><span style="color:#d08770;">2</span><span>), {idx, val -&gt; val </span><span style="color:#b48ead;">* </span><span style="color:#d08770;">3</span><span>})
</span><span style="color:#96b5b4;">echo</span><span> list</span><span style="color:#d08770;">2
</span><span style="color:#96b5b4;">echo</span><span> list</span><span style="color:#d08770;">3
</span></code></pre>
<p>以上示例也说明了 <code>map()</code> 函数是原位修改的，如果不想修改原集合，可先调用
<code>copy()</code> 创建副本。低版本中等效的用字符串调用方式如下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">echo map</span><span>([</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>], </span><span style="color:#a3be8c;">&#39;v:val * 2&#39;</span><span>)
</span></code></pre>
<p>像这样简单的功能，也许字符串方式写来更简洁，但稍为复杂的功能，可执行字符串的表
示法就可能比较费解了。比如要将原列表中每个元素加上尖括号 <code>&lt;&gt;</code> 括起来，以下三种
调用方式都能实现：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#96b5b4;">echo map</span><span>([</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>], </span><span style="color:#a3be8c;">&#39;&quot;&lt;&quot; . v:val . &quot;&gt;&quot;&#39;</span><span>)
</span><span style="color:#96b5b4;">echo map</span><span>([</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>], </span><span style="color:#a3be8c;">&#39;printf(&quot;&lt;%s&gt;&quot;, v:val)&#39;</span><span>)
</span><span style="color:#96b5b4;">echo map</span><span>([</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>], {idx, val -&gt; </span><span style="color:#8fa1b3;">printf</span><span>(</span><span style="color:#a3be8c;">&#39;&lt;%s&gt;&#39;</span><span>, val)})
</span></code></pre>
<p>用 lambda 表达式可避免多重引号的理解困难。而且 lambda 表达式或函数若预先定义的
话，在其他地方也是可用的。而含 <code>v:val</code> 的特征字符串，放在其他地方几乎是没什么
意义了。</p>
<ul>
<li>filter({expr1}, {expr2}) 过滤集合内的元素</li>
</ul>
<p><code>filter()</code> 与 <code>map()</code> 函数类似。参数二所代表的处理函数，也接收索引与值两个参数
，但是要求返回布尔逻辑值。如果返回的是真（数字 1），则保留不处理，如果返回的是
假（数字 0），则删除相应的元素。模拟流程如下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#b48ead;">function</span><span>! </span><span style="color:#8fa1b3;">FilterDict</span><span>(dict, </span><span style="color:#b48ead;">fun</span><span>)
</span><span>    </span><span style="color:#b48ead;">for</span><span> [</span><span style="color:#bf616a;">l:key</span><span>, </span><span style="color:#bf616a;">l:val</span><span>] </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">items</span><span>(</span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>dict)
</span><span>        </span><span style="color:#96b5b4;">let </span><span style="color:#bf616a;">l:bKeep</span><span> = </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span style="color:#8fa1b3;">fun</span><span>(</span><span style="color:#bf616a;">l:key</span><span>, </span><span style="color:#bf616a;">l:val</span><span>)
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#8fa1b3;">empty</span><span>(</span><span style="color:#bf616a;">l:bKeep</span><span>)
</span><span>            unlet </span><span style="color:#96b5b4;">a</span><span style="color:#b48ead;">:</span><span>dict[</span><span style="color:#bf616a;">l:key</span><span>]
</span><span>        </span><span style="color:#b48ead;">endif
</span><span>    </span><span style="color:#b48ead;">endfor
</span><span style="color:#b48ead;">endfunction
</span></code></pre>
<p>自己模拟过滤列表可能略有麻烦，因为如果正向迭代，删除元素后，索引可能会变化。当
然了，你不必真的自己写或用这样的模拟函数，请用内置的库函数！</p>
<p>同样地，可以用字符串或 lambda 表达式。且在支持 lambda 表达式的 vim 中，尽量用
lambda 表达式。</p>
<ul>
<li>sort({list} [, {fun}, {self}]) 为列表排序，从小到大</li>
<li>uniq({list} [, {fun}, {self}]) 删除相邻重复元素</li>
</ul>
<p>几乎在任一本算法教科书，排序都是重点。但是几乎在任一个语言中，排序都有已优化实
现的库函数，不必自己写的，自己需要做的只是提供比较函数，说明要如何排序的需求。
VimL 要求的比较函数能接收两个参数，返回值意义如下：</p>
<ul>
<li><code>0</code> 两个参数视为相等</li>
<li><code>1</code> 第一个参数视为比第二个参数大</li>
<li><code>-1</code> 第一个参数视为比第二个参数小</li>
</ul>
<p><code>sort()</code> 函数只能为列表排序，因为字典是无序的。第二参数 <code>{fun}</code> 一般是函数引用
，可用 lambda 表达式，但不支持像 <code>map()</code> 那样的可执行字符串。然而，可以是普通
字符用于表示 vim 预设的几种排序策略（常用需求）：</p>
<ul>
<li>空串或省略，按字符串排序，类似 <code>:sort</code> 命令为当前 buffer 的排序行为。</li>
<li><code>l</code> 或 <code>i</code>，忽略大小写的排序</li>
<li><code>n</code> 按数字排序，非数字类型的元素认为是 0</li>
<li><code>N</code> 按数字排序，字符串会转为数字</li>
<li><code>f</code> 按数字排序，列表元素限定仅是数字或浮点数</li>
</ul>
<p>VimL 的 <code>sort()</code> 是稳定排序算法，即如果两个元素相等（按 <code>{fun}</code> 返回 <code>0</code>），排
序后它们也保持原来的相对顺序。如果 <code>{fun}</code> 参数是含 <code>dict</code> 属性的函数，则要提
供第三参数 <code>{self}</code> ，一个作为 <code>self</code> 的字典变量。</p>
<p><code>uniq()</code> 函数的参数用法与 <code>sort()</code> 相同。且一般应该对已排序的列表调用 <code>uniq()</code>
，因为它只比较相邻元素而去重。</p>
<h3 id="xiao-jie">小结</h3>
<p>VimL 的标量主要就是字符串与数字，集合也就列表与字典。所以为这些数据类型提供了
大量的库函数 api。用 <code>:h type()</code> 查看支持的所有变量类型。但其他类型需要支持的
操作非常有限，故无必要有什么专门函数处理。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch06-builtin-function/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
