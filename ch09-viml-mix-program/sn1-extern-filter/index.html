<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
    

      <title></title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://lymslive.github.io/vimllearn/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch00-prefcace/">
                                    
                                    前言
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/">
                                    
                                    第一章 VimL 语言主要特点
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn1-hello-world/">
                                                    
                                                    1.1 Hello World 的四种写法
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn2-from-ex-command/">
                                                    
                                                    1.2 同源 ex 命令行
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn3-week-type-strong-scope/">
                                                    
                                                    1.3 弱类型强作用域
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch01-viml-feature/sn4-autoload-schema/">
                                                    
                                                    1.4 自动加载脚本机制
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/">
                                    
                                    第二章 VimL 语言基本语法
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn1-variable-type/">
                                                    
                                                    2.1 变量与类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn2-comapare-condition/">
                                                    
                                                    2.2 选择与比较
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn3-loop-iterate/">
                                                    
                                                    2.3 循环与迭代
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn4-function-call/">
                                                    
                                                    2.4 函数定义与使用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch02-viml-grammar/sn5-exception-error/">
                                                    
                                                    2.5 异常处理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/">
                                    
                                    第三章 Vim 常用命令
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn1-option-set/">
                                                    
                                                    3.1 选项设置
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn2-key-remap/">
                                                    
                                                    3.2 快捷键重映射
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn3-custom-command/">
                                                    
                                                    3.3 自定义命令
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn4-execute-normal/">
                                                    
                                                    3.4 execute 与 normal
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn5-autocmd-event/">
                                                    
                                                    3.5 自动命令与事件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch03-viml-command/sn6-debug-command/">
                                                    
                                                    3.6 调试命令
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/">
                                    
                                    第四章 VimL 数据结构进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn1-list-string/">
                                                    
                                                    4.1 再谈列表与字符串
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn2-dictionary/">
                                                    
                                                    4.2 通用的字典结构
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn3-nest-compose/">
                                                    
                                                    4.3 嵌套组合与扩展
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch04-viml-datastruct/sn4-regex-apply/">
                                                    
                                                    4.4 正则表达式
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/">
                                    
                                    第五章 VimL 函数进阶
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn1-variable-argument/">
                                                    
                                                    5.1 可变参数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn2-function-refer/">
                                                    
                                                    5.2 函数引用
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn3-dict-function/">
                                                    
                                                    5.3 字典函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn4-closure-lambda/">
                                                    
                                                    5.4 闭包函数
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch05-viml-function/sn5-autoload-function/">
                                                    
                                                    5.5 自动函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/">
                                    
                                    第六章 VimL 内建函数使用
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn1-operate-datatype/">
                                                    
                                                    6.1 操作数据类型
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn2-operate-edit-object/">
                                                    
                                                    6.2 操作编辑对象
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn3-operate-filesystem/">
                                                    
                                                    6.3 操作系统文件
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch06-builtin-function/sn4-other-utility/">
                                                    
                                                    6.4 其他实用函数
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/">
                                    
                                    第七章 VimL 面向对象编程
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn1-object-intro/">
                                                    
                                                    7.1 面向对象的简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn2-dict-object/">
                                                    
                                                    7.2 字典即对象 
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch07-object-program/sn3-object-organize/">
                                                    
                                                    7.3 自定义类的组织管理
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/">
                                    
                                    第八章 VimL 异步编程特性
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn1-asynchronous-intro/">
                                                    
                                                    8.1 异步工作简介
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn2-asynchronous-job/">
                                                    
                                                    8.2 使用异步任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn3-channle-job/">
                                                    
                                                    8.3 使用通道控制任务
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch08-viml-asynchronous/sn4-internal-terminal/">
                                                    
                                                    8.4 使用配置内置终端
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/">
                                    
                                    第九章 VimL 混合编程
                                </a>
                                
                                    <ul>
                                        
                                            <li class="active">
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn1-extern-filter/">
                                                    
                                                    9.1 用外部语言写过滤器
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">
                                                    
                                                    9.2 外部语言接口编程
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn3-perl-interface/">
                                                    
                                                    9.3 Perl 语言接口开发
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/">
                                    
                                    第十章 Vim 插件管理与开发
                                </a>
                                
                                    <ul>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn1-plugin-directory/">
                                                    
                                                    10.1 典型插件的目录规范
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn2-plugin-manager/">
                                                    
                                                    10.2 插件管理器插件介绍
                                                </a>
                                            </li>
                                        
                                            <li >
                                                <a href="https://lymslive.github.io/vimllearn/ch10-viml-plugin-develop/sn3-plugin-devflow/">
                                                    
                                                    10.3 插件开发流程指引
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https://lymslive.github.io/vimllearn/chA1-postfcace/">
                                    
                                    结语
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <span class="search-icon">🔎</span>
                
            </div>

            <div class="page__content">
                
                <div class="search-container">
                    <input id="search" type="search" placeholder="Search..">
                    <div class="search-results">
                        <div class="search-results__header"></div>
                        <ul class="search-results__items"></ul>
                    </div>
                </div>
                
                <div class="book-content">
                    
    <h1>9.1 用外部语言写过滤器</h1>
    <!-- ## 9.1 用外部语言写过滤器 -->
<h3 id="9-1-1-hun-he-bian-cheng-chang-jing-jie-shao">9.1.1 混合编程场景介绍</h3>
<p>本章来讨论 VimL 与其他语言混合编程的话题。这“混合”编程可能不是很准确的定义，也
许涉及不同层面的场景应用。在上一章介绍的异步编程也算是其中一种吧。不过如果所调
用的外部程序是别人已经写好的（或者是系统提供的经典工具），那用户就只能适应其提
供的接口或输出，在 vim 端几乎没什么可干预的。但如果利用通道连接的另一端的程序
，也要自己开发，那就可以从设计开始就考虑如何更好地与 VimL 协作，并且显然另一端
可以使用任何主流语言。这就不再多说了，本章主要着眼于其他场景的（同步）混合编程。</p>
<p>与众所周知的另一件编辑神器相比， vim 是比较纯粹的编辑器，它本身提供的功能（虽
然编辑方面非常丰富）比较集中，也就比较依赖或吻合 Unix 哲学：一个工具把自己的事
做好，并且便于与其他工具配合。所以，当 vim 想处理更复杂的事务时，它天然地倾向于
与其他工具“混用”。比如，从最基本打开文件编辑，vim 也接受从其他工具的管道输入：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> ls</span><span style="color:#bf616a;"> -l </span><span>| </span><span style="color:#bf616a;">vim</span><span> -
</span></code></pre>
<p>这个命令表示将当前目录下的文件列表送入 vim 中编辑，譬如打算在每行前面添加 <code>mv </code> 命令，想仔细规划下如何批量重命名。</p>
<p>就像许多 Unix 工具一样，启用 vim 时若用 <code>-</code> 取代文件名参数，就表示从标准输入读
入内容，所以它很容易配合管道，作为接收管道输入的末端。但由于 vim 常规运用是作
为可视化交互式全屏编辑，它不再产生标准输出，因而也不便继续产生管道输出至下一工
序。然而， vim 也有批量模式，不会打开交互界面，实际上也是可以强行配合，达到类
似 <code>sed</code> 的流编辑效果——但这就似乎有点旁门左道了，不是 vim 的常规用法。</p>
<p>当然，管道的配合，只是工具的组合与混用，离“可编程”的概念还比较远。</p>
<p>在支持异步的版本之前，<code>system()</code> 函数只能在 VimL 这端进行逻辑与流程控制，而对
所调用的外部命令不可控，这可算“半混合”编程。其实还有另一个叫“过滤器”的功能用法
，它是允许与鼓励对所调用的外部脚本进行编程，但在 vim 这端的用法却是固定的，因
而也可算是另一种“半混合”编程。</p>
<p>除了自己写通道服务算“全混合”编程外， vim 在这之前还提供了多种脚本语言的内置接
口，那也算是（同步的）“全混合”编程了。本节先介绍相对简单的过滤器，下一节再介绍
语言接口。</p>
<h3 id="9-1-2-guo-lu-qi-de-gai-nian-yu-shi-yong">9.1.2 过滤器的概念与使用</h3>
<p>即使你对过滤器并不熟，但也应该用过 <code>=</code> 重缩进命令，那就是个特殊的过滤器。</p>
<p>过滤器的意思是将当前编辑 buffer 中指定范围的文本，当作标准输入调用某个外部程序
，并用其标准输出替换原范围的文本，以此达到修改、编辑的目的。因此，重缩进与格式
化的本质也就是过滤器。</p>
<p>过滤器的标准使用方式是在命令行一对地址范围之后接 <code>!</code> 与外部命令，如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>:n</span><span style="color:#d08770;">1</span><span>,n</span><span style="color:#d08770;">2</span><span> ! 外部程序
</span><span>:</span><span style="color:#d08770;">1</span><span>,$ ! 外部程序
</span><span>:</span><span style="color:#a3be8c;">&#39;&lt;, &#39;</span><span>&gt; ! 外部程序
</span><span>:</span><span style="color:#b48ead;">.</span><span> ! 外部程序
</span></code></pre>
<p>注意必须在 <code>!</code> 前有地址参数，否则 <code>!外部程序</code> 就是纯粹切到外部 shell 运行那个
外部程序了。而过滤器并不会打断用户切到外部 shell ，只要不是处理巨量文本，替换
输入输出应该都比较快，虽然是同步，一般没延迟问题。</p>
<p>如果只有一个地址参数，表示只处理一行， <code>.</code> 表示当前行。如果是两个地址参数，则
表示起始行到终止行的范围，<code>1,$</code> 表示从第一行至最后一行，即全部文本。可以在命令
行手动输入两个数字行号，也在可视模式下选择一定范围后按 <code>:</code> 自动添加 <code>'&lt;,'&gt;</code> 表
示所选择的行范围。</p>
<p>使用过滤器还有个快捷键方式，不必先按 <code>:</code> 进入命令行，直接在普通模式按 <code>!</code> 再接一
个移动命令（文本对象），也会自动帮你选定这个文本对象，并自动进入命令行模式并填
充好地址参数，用户只要继续在 <code>!</code> 之后输入想调用的外部程序。</p>
<p>诚然，过滤器可以直接调用别人写好、已经完善的外部程序。然而，由于以标准输出替换
标准输入的模型如此简单，而每个人的编辑任务又可能多种多样各具个性，在一时找不到
合用的外部工具时，用户完全可以用他所熟悉的任一种脚本语言快速写个过滤器。</p>
<p>比如再举那个简单的例子吧，给文本行编号？最简单的需求，其实可以直接用 <code>cat -n</code>
命令完成：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!cat -n
</span></code></pre>
<p>注意，从 vim 命令行调用外部过滤器时，可以附加命令行参数传给过滤器程序，选择文
本是标准输入，这两者互无关系。如果要对全文编号，一定别忘了加地址参数： <code>1,$!</code>
； vim 有不少可能作用于范围的命令，在缺省时默认表示全文，但过滤器若省了地址参
数就解释为普通 <code>!</code> 外部调用命令了。</p>
<p>但是，<code>cat -n</code> 的编号似乎不美观，右对齐，空白太多。如果你想编号左对齐，数字后
面最好还能加个符号，如 <code>1.</code> 或 <code>1)</code> 等，再或者想为指定行编号，比如跳过注释行……
等等，不一而足的需求。如果你熟悉某种脚本语言，最好是自己操起脚本语言来写适合的
过滤器。例如，下面这个 perl 脚本，实现为文本行编号：</p>
<pre data-lang="perl" style="background-color:#2b303b;color:#c0c5ce;" class="language-perl "><code class="language-perl" data-lang="perl"><span>&quot;</span><span style="color:#a3be8c;"> file: catn.pl
</span><span style="color:#a3be8c;">my </span><span>$</span><span style="color:#bf616a;">sep</span><span style="color:#a3be8c;"> = shift || </span><span>&quot;&quot;</span><span style="color:#a3be8c;">;
</span><span style="color:#a3be8c;">my </span><span>$</span><span style="color:#bf616a;">num</span><span style="color:#a3be8c;"> = shift || 0;
</span><span>$</span><span style="color:#bf616a;">sep</span><span style="color:#a3be8c;"> .= (</span><span>$</span><span style="color:#bf616a;">num</span><span style="color:#a3be8c;"> &gt; 0) ? (</span><span>&quot; &quot;</span><span style="color:#a3be8c;"> x </span><span>$</span><span style="color:#bf616a;">num</span><span style="color:#a3be8c;">) : </span><span>&quot;\</span><span style="color:#bf616a;">t</span><span>&quot;</span><span style="color:#a3be8c;">;
</span><span style="color:#a3be8c;">while (&lt;&gt;) { print </span><span>&quot;$.$</span><span style="color:#bf616a;">sep</span><span>$</span><span style="color:#bf616a;">_</span><span>&quot;</span><span style="color:#a3be8c;">; }
</span></code></pre>
<p>该过滤器脚本接受两个参数，第一参数指定紧接数字编号的后缀符号，第二参数指定之后
隔几个空白，如果缺省，就隔一个制表符。在 while 循环中，<code>&lt;&gt;</code> 符号用于从标准输入
读取数据，<code>$.</code> 表示行号， <code>$_</code> 表示当前行文本，这样语义就明确了，行号与分隔字
符串与原文本拼接起来作为标准输出。（用其他语言写这个脚本也不复杂，只是语法不一
样，总是可以手动累加行号的）</p>
<p>如果将该脚本保存在当前目录中，可以在 vim 命令行尝试一下：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!perl catn</span><span style="color:#b48ead;">.</span><span>pl
</span><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!perl catn</span><span style="color:#b48ead;">.</span><span>pl </span><span style="color:#b48ead;">.
</span><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!</span><span style="color:#b48ead;">.</span><span>/catn</span><span style="color:#b48ead;">.</span><span>pl </span><span style="color:#b48ead;">. </span><span style="color:#d08770;">2
</span></code></pre>
<p>如果给脚本添加了可执行权限，可直接将脚本作为过滤器程序，否则就将脚本文件当作
perl 解释器的第一参数。如果脚本不在当前目录，请替换为脚本全路径，或者若将可执
行脚本放在某个 <code>$PATH</code> 路径中，也可以直接使用。然后要注意命令参数，会先后经过
vim 命令行与 shell 命令行两层处理，对特殊字符最好加引号或转义，避免出错。例如：</p>
<pre data-lang="vim" style="background-color:#2b303b;color:#c0c5ce;" class="language-vim "><code class="language-vim" data-lang="vim"><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!</span><span style="color:#b48ead;">.</span><span>/catn</span><span style="color:#b48ead;">.</span><span>pl </span><span style="color:#a3be8c;">&#39;)&#39; </span><span style="color:#d08770;">2
</span><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!</span><span style="color:#b48ead;">.</span><span>/catn</span><span style="color:#b48ead;">.</span><span>pl </span><span style="color:#a3be8c;">&#39;*&#39; </span><span style="color:#d08770;">2
</span><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!</span><span style="color:#b48ead;">.</span><span>/catn</span><span style="color:#b48ead;">.</span><span>pl </span><span style="color:#b48ead;">\% </span><span style="color:#d08770;">2
</span><span>:</span><span style="color:#a3be8c;">&#39;&lt;,&#39;</span><span>&gt;!</span><span style="color:#b48ead;">.</span><span>/catn</span><span style="color:#b48ead;">.</span><span>pl </span><span style="color:#a3be8c;">&#39;\#&#39; </span><span style="color:#d08770;">2
</span></code></pre>
<p>如果 <code>)</code> 不加引号，会出现 shell 语法错误；如果 <code>*</code> 不加引号，在 shell 中会展开
为当前文件的所有文件名，这可能不是想要的；当然这两个字符也可以用 <code>\</code> 转义，
安全地从 shell 命令行传入 <code>catn.pl</code> 过滤器脚本。</p>
<p>Vim 命令行中的 <code>%</code> 符号会被展开为当前文件名，即使用引号，也是将文件名字符串括
在引号中传给 shell （如果文件名中有空格，有无引号影响 shell 将其作为几个参数）
，如果要将百分号传给 shell ，就得用 <code>\%</code> 反杠转义。<code>#</code> 在 vim 命令行中会被展开
为“上一个编辑过的”文件名，仅用 <code>\#</code> 可以将 <code>#</code> 传给 shell ，但在 shell 中这符
号是注释，那又会有问题，所以必须用 <code>'\#'</code> 两层保护，才能将 <code>#</code> 符号传入过滤器脚
本中，输出类似 <code>1#</code> <code>2#</code> 的编号效果。</p>
<p>记不住这许多特殊符号规则怎么办，很简单呀，多试试就好，或者用保守的 <code>'\#'</code> 就差
不多了。而且在 vim 试错了过滤器（参数问题，或脚本本身 bug）不要紧，如果意外修
改了文本，按撤销命令 <code>u</code> 就好。</p>
<p>当然，有时特意利用 vim 特殊符号的替换意义也可能是有用的，例如你又想文件名放在
行号之前了，类似 <code>file:1</code> 的效果。那么就可以在 vim 命令行中传入 <code>'%'</code> 参数，如
果确认当前文件名中没空格，也可以不用引号。当然了，这个过滤器脚本本身的逻辑功能
也要作相应修改了。</p>
<p>所以你看，只要你经常脑洞大开，需求总是在不断变化。然而只要掌握一门脚本语言，哪
怕只会写简单的教科书式的标准输入输出的小程序，运用过滤器思维，就能极大地扩展
vim 的编辑效率与趣味性。</p>


                </div>
            </div>

            <div class="prev-link">
                
    
        
        
        <a class="previous" href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/"><</a>
    

            </div>

            <div class="next-link">
                
    
        <a class="next" href="https://lymslive.github.io/vimllearn/ch09-viml-mix-program/sn2-extern-interface/">></a>
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/elasticlunr.min.js"></script>
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/search_index.en.js"></script>
            
            <script type="text/javascript" src="https://lymslive.github.io/vimllearn/book.js"></script>
        
    </body>

</html>
